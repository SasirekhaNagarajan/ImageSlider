Lyte.Component.register("lyte-calculator",{_template:'<template tag-name="lyte-calculator">\n  <div class="lyteCalculator basic" tabindex="0" onkeydown="{{action(\'keydown\',event)}}" onkeyup="{{action(\'keyup\',event)}}">\n    <div class="calculatorDisplay">\n    <template is="if" value="{{ltPropEditable}}"><template case="true">\n         <input type="text" class="lyteCalculatorTextField" autocomplete="off" onmousedown="{{action(\'mdwnTextField\',event)}}" onmouseup="{{action(\'mupTextField\',event)}}" spellcheck="false">\n   </template><template case="false">\n        <div>\n            <div class="lyteCalculatorTextField" tabindex="0"></div>\n         </div>   \n    </template></template>\n      <div class="calculatorDispspan">0</div>\n      <div class="calculatorrad"></div>\n    </div>\n    <div class="calculatorbuttons" onmousedown="{{action(\'mousedown\',event)}}" onmouseup="{{action(\'mouseup\',event)}}">\n        <div class="calculatorToggle">\n        <span class="calculatorsmaller"></span> \n        </div>\n        <div class="advancedCalculator">\n            <span class="CalculatorBtn15">2<sup>nd</sup></span>\n            <span class="CalculatorBtn15">m+</span>\n            <span class="CalculatorBtn15">m-</span>\n            <span class="CalculatorBtn15 memorymr">mr</span>\n            <span class="CalculatorBtn15">mc</span>\n            <span class="CalculatorBtn14 Deg">Deg</span>\n            <span class="CalculatorBtn15">(</span>\n            <span class="CalculatorBtn15">)</span>\n            <span class="CalculatorBtn14">Rand</span>\n            <span class="CalculatorBtn15">1/x</span>\n            <span class="CalculatorBtn15">log<sub>y</sub></span>\n            <span class="CalculatorBtn16 pieButton">p</span>\n            <span class="CalculatorBtn14">E</span>\n            <span class="CalculatorBtn16">e</span>\n            <span class="CalculatorBtn15">!</span>\n            <span class="CalculatorBtn17 toggleBtns squareroot">x<sup>2</sup></span>\n            <span class="CalculatorBtn15 toggleBtns logbtn">log</span>\n            <span class="CalculatorBtn14 toggleBtns trignometry">sin</span>\n            <span class="CalculatorBtn14 toggleBtns trignometry">cos</span>\n            <span class="CalculatorBtn14 toggleBtns trignometry">tan</span>\n            <span class="CalculatorBtn17 toggleBtns calcLeft lastrow cuberoot">x<sup>y</sup></span>\n            <span class="CalculatorBtn16 toggleBtns lastrow naturallog">ln</span>\n            <span class="CalculatorBtn14 toggleBtns lastrow hyperbolic">sinh</span>\n            <span class="CalculatorBtn14 toggleBtns lastrow hyperbolic">cosh</span>\n            <span class="CalculatorBtn14 toggleBtns lastrow hyperbolic">tanh</span>\n        </div>\n        <div class="basicCalculator">\n            <span class="calcBackspace">C</span>\n            <span class="calcClearAc">AC</span>\n            <span class="calcPercent">%</span>\n            <span class="basicOp calcDivide">/</span>\n            <span>7</span>\n            <span>8</span>\n            <span>9</span>\n            <span class="basicOp calcMultiply">*</span>\n            <span>4</span>\n            <span>5</span>\n            <span>6</span>\n            <span class="basicOp calcAdd">+</span>\n            <span>1</span>\n            <span>2</span>\n            <span>3</span>\n            <span class="basicOp calcSub">-</span>\n            <span class="lastrow doubleWidth calcLeft">0</span>\n            <span class="calzero lastrow">.</span>\n            <span class="basicOp lastrow calcRight calcEqual">=</span>\n        </div>\n    </div>\n  </div>\n</template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[]}},default:{}},{type:"attr",position:[1,3]}],_observedAttributes:["bigger","equation","previous","numstack","opstack","rank","secondLayer","operator","check_error","deg","memory","secondLayer","secondKeySet","secondActive","secondValue","cursor","cursorIndex","ltPropEditable","ltPropAutoFocus"],data:function(){return{bigger:Lyte.attr("boolean",{default:!1}),equation:Lyte.attr("string"),previous:Lyte.attr("string"),numstack:Lyte.attr("array",{default:[]}),opstack:Lyte.attr("array",{default:[]}),rank:Lyte.attr("object",{default:void 0}),secondLayer:Lyte.attr("array",{default:[]}),operator:Lyte.attr("string",{default:""}),check_error:Lyte.attr("boolean",{default:!1}),deg:Lyte.attr("boolean",{default:!1}),memory:Lyte.attr("number",{default:0}),secondLayer:Lyte.attr("array",{default:[]}),secondKeySet:Lyte.attr("array",{default:[]}),secondActive:Lyte.attr("boolean",{default:!1}),secondValue:Lyte.attr("array",{default:[]}),cursor:Lyte.attr("boolean",{default:!1}),cursorIndex:Lyte.attr("number",{default:0}),ltPropEditable:Lyte.attr("boolean",{default:!1}),ltPropAutoFocus:Lyte.attr("boolean",{default:!1})}},init:function(){this.setData("secondLayer",[["x<sup>2</sup>","log","sin","cos","tan","x<sup>y</sup>","ln","sinh","cosh","tanh"],["sqrt","10<sup>x</sup>","sin<sup>-1</sup>","cos<sup>-1</sup>","tan<sup>-1</sup>","xry","e<sup>x</sup>","sinh<sup>-1</sup>","cosh<sup>-1</sup>","tanh<sup>-1</sup>"]]),this.setData("rank",{"=":0,"+":1,"-":1,"/":2,"*":2,"~":6,N:5,"^":5,E:4,s:7,c:7,t:7,l:7,S:7,C:7,T:7,L:7,i:7,o:7,a:7,I:7,O:7,A:7,G:7,Q:7,"%":3,"!":3})},didConnect:function(){var t=this.$node.querySelector(".calculatorbuttons"),e=[],a=this.getData("secondLayer"),r=(this.getData("brackets"),[].slice.call(t.querySelector(".advancedCalculator").children,15,25));this.setData("secondKeySet",r);for(var s=2;s>=0;s--)for(var n=t.children[s],i=(o=n.children).length;i--;)e[n.children[i].textContent.replace(/\s*/g,"")]=n.children[i];var o;for(i=(o=a[0]).length;i--;){var l=o[i];"x<sup>2</sup>"===l?l="x2":"x<sup>y</sup>"===l&&(l="xy"),e[a[1][i].replace(/<\/*\w+>/g,"")]=e[l]}e.Rad=e.Deg,this.setData("keyBoard",e),this.getData("ltPropEditable")||$L(".lyteCalculatorTextField",this.$node).scroll({preventVertical:!0,preventHorizontal:!0}),this.getData("ltPropAutoFocus")&&this.$node.querySelector(".lyteCalculatorTextField").focus()},render:function(t,e){var a,r=t.match(/\./),s=this.$node.querySelector(".calculatorDispspan");this.$node.querySelector(".lyteCalculatorTextField");if(valAbs=Math.abs(+t),displayStyle=s.style,displayParentStyle=s.parentNode.style,t.match(/NaN|Inf/))a="NaN";else{if("Error"===t)return a=t,void(s.innerHTML=" ");valAbs>=1e16&&(t=(+t).toExponential(13)+""),e&&"+/-"!==e||0===valAbs||(t=(+t).toPrecision(12)),(a=(t+"").split("."))[1]&&(a[2]=a[1].split("e"),a[2][1]&&(a[1]=a[2][0]),e&&"+/-"!==e||(a[1]=(+("1."+a[1])).toPrecision(12)+"",a[1]>=2&&(a[0]=+a[0]+1+""),a[1]=a[1].substr(2).replace(/0+$/,""))),a=a[0]+(a[1]||r?"."+a[1]:"").replace(".undefined","").replace(e?"":/\.$/,"")+(a[2]&&a[2][1]?"e"+a[2][1]:"")}a=a.replace(/\./g,"#").replace(/\s/g,",").replace(/#/g,"."),s.innerHTML=a},getTargetKey:function(t){for(var e=this.$node.querySelector(".lyteCalculator");t!==e&&-1===t.className.indexOf("calculatorToggle")&&-1===t.className.indexOf("lyteCalculatorTextField")&&-1===t.className.indexOf("calculatorsmaller")&&t.parentNode&&-1===t.parentNode.className.indexOf("basicCalculator")&&-1===t.parentNode.className.indexOf("advancedCalculator");)t=t.parentNode;return t},keyUp:function(){var t=this.getData("pressedKey"),e=this.getData("secondActive");t&&t!==e&&(t.className=t.className.replace(" calc-press",""),t=null,this.setData("pressedKey",t))},keyDown:function(t,e){var a=t||window.event,r=(e||this.getTargetKey(a.target)).textContent.replace(/\s*/g,""),s=this.getData("keyBoard")[r],n=this.getData("pressedKey");return s&&(this.keyUp(),n=s,this.setData("pressedKey",n),s.className=s.className+" calc-press"),!1},preformMouseUp:function(t){var e,a=this.$node.querySelector(".lyteCalculatorTextField"),r=[];e=this.getData("ltPropEditable")?a.value:a.innerHTML,equation=e;var s=this.convertequation(equation).split(/([0-9.]+|\(|\)|\+|\-|\/|\*|\^|~|N|s|c|t|l|S|C|T|!|%|L|i|o|a|I|O|A|G|E|p|R|e|Q)/g).filter(function(t){return""!=t});if(s.length>=2&&!s[s.length-1].match(/[!|%|^]/)&&this.isOperator(s[s.length-1])&&s[s.length-2].match(/[0-9!pe%)]/))s=(s=e.split(/(p|Rand|e|arcsinh\(|arccosh\(|arctanh\(|arcsin\(|ln\(|arccos\(|arctan\(|sinh\(|cosh\(|tanh\(|sin\(|cos\(|tan\(|logy\(|log\(|sqrt\(|N\(|\(|\)|\+|\-|\|*|\^|!|%)/g).filter(function(t){return""!=t})).splice(0,s.length-1),equation=s.join("");else if(s.length>=2&&!s[s.length-1].match(/[!|%]/)&&this.isOperator(s[s.length-1]))return this.render("Error"),void this.keyUp();equation=this.standardizeString(equation),this.getData("check_error")||(r=this.processString(equation)),this.getData("check_error")||(r=this.postfix(r)),this.getData("check_error")||(equation=this.valueMath(r)),this.getData("check_error")?this.render("Error"):(this.render(equation),this.keyUp())},processString:function(t){for(var e=t.split(/([0-9.]+|\(|\)|\+|\-|\/|\*|\^|~|N|s|c|t|l|S|C|T|!|%|L|i|o|a|I|O|A|G|E|p|R|e|Q)/g).filter(function(t){return""!=t}),a=0;a<e.length;a++){if(a<e.length-1&&("p"===e[a]||"R"===e[a]||"e"===e[a])&&!this.isOperator(e[a+1]))return this.setData("check_error",!0),null;if(0==a&&!e[0].match(/[0-9a-zA-Zpe(.~]/))return this.setData("check_error",!0),null;if(0===a&&"G"===e[0])return this.setData("check_error",!0),null;if(a<e.length-1&&!e[a].match(/[(|)|%|!]/)&&!e[a+1].match(/[(]/)&&this.isOperator(e[a])&&!this.isOneMath(e[a])&&this.isOperator(e[a+1])&&!this.isOneMath(e[a+1]))return this.setData("check_error",!0),null;if(a<e.length-1&&"!"===!e[a]&&e[a+1].match(/[E]/))return this.setData("check_error",!0),null;if(a<e.length-1&&e[a].match(/[(]/)&&this.isOperator(e[a+1])&&!this.isOneMath(e[a+1]))return this.setData("check_error",!0),null;if(a<e.length-1&&this.isOneMath(e[a])&&this.isOperator(e[a+1])&&!this.isOneMath(e[a+1]))return this.setData("check_error",!0),null}return e},postfix:function(t){var e=[],a=[],r=this.getData("rank"),s=0;if(1===t.length)return t;for(var n=0;n<t.length;n++){var i=t[n];if(this.isOperator(i))if("("===i)a.push(i);else if(")"===i){var o;do{"("!==(o=a[a.length-1][0])&&(e[s]=a[a.length-1],s++),a.pop()}while("("!==o)}else{for(;0!==a.length&&r[a[a.length-1]+""]>=r[i+""];)e[s]=a.pop(),s++;a.push(i)}else e[s]=i,s++}for(;0!=a.length;)e[s]=a.pop(),s++;return e},factorial:function(t){return t<0||t>170?NaN:t<=1?1:t*this.factorial(t-1)},valueMath:function(t){for(var e,a=[],r=this.getData("deg"),s=Math.PI,n=0;n<t.length;n++){var i=t[n];if("p"===i)a.push(Math.PI);else if("e"===i)a.push(Math.exp(1));else{if(!this.isOperator(i)&&!i.match(/^(\d*\.)?\d+$/))return"Error";if(this.isOperator(i)){if(0===a.length)return"Error";var o=a.pop();switch(i){case"~":e=-o;break;case"s":e=r||Math.abs(o)!==s?Math.sin(o*(r?s/180:1))+"":"0";break;case"c":e=Math.cos(o*(r?s/180:1))+"";break;case"t":e=r||Math.abs(o)!==s?Math.tan(o*(r?s/180:1))+"":"0";break;case"%":e=o/100;break;case"!":if(!(o>=0&&parseInt(o)===o))return"NaN";e=this.factorial(Math.round(+o));break;case"l":e=Math.log(o)/Math.log(10);break;case"L":e=Math.log(o);break;case"S":e=(Math.pow(Math.E,o)-Math.pow(Math.E,-1*o))/2;break;case"C":e=(Math.pow(Math.E,o)+Math.pow(Math.E,-1*o))/2;break;case"T":var l=Math.pow(Math.E,o),c=Math.pow(Math.E,-1*o);e=l==1/0?1:c==1/0?-1:(l-c)/(l+c);break;case"i":e=Math.asin(o)*(r?180/s:1);break;case"o":e=Math.acos(o)*(r?180/s:1);break;case"a":e=Math.atan(o)*(r?180/s:1);break;case"I":e=Math.log(+o+Math.sqrt(1+Math.pow(o,2)));break;case"O":e=2*Math.log(Math.sqrt((+o+1)/2)+Math.sqrt((+o-1)/2));break;case"A":e=(Math.log(+o+1)-Math.log(1-o))/2;break;case"Q":e=Math.pow(o,.5)}if(0!==a.length){var h=a[a.length-1];switch(i){case"+":e=parseFloat(h)+parseFloat(o),a.pop();break;case"-":e=h-o,a.pop();break;case"*":e=h*o,a.pop();break;case"/":if(0==o)return"NaN";e=h/o,a.pop();break;case"^":e=Math.pow(h,o),a.pop();break;case"N":e=Math.pow(o,1/h),a.pop();break;case"E":e=h*Math.pow(10,o),a.pop();break;case"G":e=Math.log(o)/Math.log(h),a.pop()}}a.push(e)}else a.push(parseFloat(i))}}return a.pop()+""},checkrank:function(t){var e=this.getData(e),a=this.getData("rank");return e.length>0||e.length>0&&a[e.length-1]<a[t]},isOperator:function(t){return!!t.match(/^[+|\-|/|*|^|~|N|s|c|t|l|S|C|T|!|%|(|L|)|i|o|a|I|O|A|E|G|Q]+$/)},isOneMath:function(t){return!!t.match(/^[s|c|t|l|S|C|T|(|L|i|o|a|I|O|A|Q|~]+$/)},convertequation:function(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=this.convertToPiandRoot(t)).trim()).replace("\\s+"," ")).replace(/sqrt/g,"Q")).replace(/logy/g,"G")).replace(/arcsinh/g,"I")).replace(/arccosh/g,"O")).replace(/arctanh/g,"A")).replace(/arcsin/g,"i")).replace(/arccos/g,"o")).replace(/arctan/g,"a")).replace(/log/g,"l")).replace(/sinh/g,"S")).replace(/cosh/g,"C")).replace(/tanh/g,"T")).replace(/sin/g,"s")).replace(/cos/g,"c")).replace(/tan/g,"t")).replace(/Rand/g,"R")).replace(/ln/g,"L")},convertToPiandRoot:function(t){var e=String.fromCharCode(parseInt("221A",16)),a=String.fromCharCode(parseInt("03C0",16)),r=new RegExp(a,"g");return t=t.replace(r,"p"),r=new RegExp(e,"g"),t=t.replace(r,"N")},standardizeString:function(t){var e,a,r="";if(e=(t=this.convertequation(t)).split("(").length,(a=t.split(")").length)>e)return this.setData("check_error",!0),null;for(var s=0;s<e-a;s++)t+=")";for(s=0;s<t.length;s++)s>0&&this.isOneMath(t[s])&&(")"==t[s-1]||t[s-1].match(/^[\d|\.|!|%|p|R|e]$/))&&(r+="*"),(0===s||s>0&&!t[s-1].match(/^[\d|\.|%|!]$/))&&"-"===t[s]&&t[s+1]&&(t[s+1].match(/^[\d|\.]$/)||"R"===t[s+1]||"e"===t[s+1]||"p"===t[s+1]||"("===t[s+1]||this.isOneMath(t[s+1]))?r+="~":(0===s||s>0&&"("===t[s-1])&&"+"===t[s]&&t[s+1]&&(t[s+1].match(/^[\d|\.]$/)||"R"===t[s+1]||"e"===t[s+1]||"p"===t[s+1]||"("===t[s+1])?r+="":s>0&&(t[s-1].match(/^[\d|\.]$/)||")"===t[s-1]||"R"===t[s-1]||"e"===t[s-1]||"p"===t[s-1])&&"p"===t[s]?r=r+"*"+t[s]:s>0&&(t[s-1].match(/^[\d|\.]$/)||")"===t[s-1]||"p"===t[s-1]||"e"===t[s-1]||"R"===t[s-1])&&"R"===t[s]?r=r+"*"+t[s]:s>0&&(t[s-1].match(/^[\d|\.]$/)||")"===t[s-1]||"p"===t[s-1]||"R"===t[s-1]||"e"===t[s-1])&&"e"===t[s]?r=r+"*"+t[s]:s>0&&"%"===t[s-1]&&(t[s].match(/^[\d|\.]$/)||"p"===t[s]||"R"===t[s]||"e"===t[s])?r=r+"*"+t[s]:s>0&&"!"===t[s-1]&&(t[s].match(/^[\d|\.]$/)||"p"===t[s]||"R"===t[s]||"e"===t[s])?r=r+"*"+t[s]:s>0&&(")"===t[s-1]||"p"===t[s-1]||"R"===t[s-1]||"e"===t[s-1])&&t[s].match(/^[\d|\.]$/)?r=r+"*"+t[s]:r+=t[s];return r},clearValue:function(){var t=this.$node.querySelector(".lyteCalculatorTextField");this.setData("check_error",!1),this.setData("cursorIndex",0),this.getData("ltPropEditable")?t.value="":t.innerHTML="",this.$node.querySelector(".calculatorDispspan").innerHTML="0"},memoryoperations:function(t){var e=this.getData("memory"),a=this.$node.querySelector(".calculatorDispspan").innerHTML,r=this.$node.querySelector(".lyteCalculatorTextField");if("mc"===t)e=0,this.$node.querySelector(".memorymr").classList.remove("active");else if("m+"===t)e+=parseFloat(a),this.$node.querySelector(".memorymr").classList.add("active");else if("m-"===t)e-=parseFloat(a),this.$node.querySelector(".memorymr").classList.add("active");else if("mr"===t){var s,n=this.getData("cursorIndex");if(s=this.getData("ltPropEditable")?r.value:r.innerHTML,i=this.convertToPiandRoot(s),!this.getData("check_error")){if(0==s.length||0==n||i[n-1]&&!i[n-1].match(/[0-9.]/)){if(s.length>n&&i[n].match(/[0-9.]/))return;var i=s.substring(0,n)+e+s.substring(n,s.length);this.getData("ltPropEditable")?r.value=i:r.innerHTML=i,this.setData("cursorIndex",n+(e+"").length)}this.setData("check_error",!1),this.preformMouseUp()}}this.setData("memory",e)},getSelectionIndex:function(){var t=this.$node.querySelector(".lyteCalculatorTextField");if(document.selection){t.focus();var e=document.selection.createRange(),a=e.text.length;return e.moveStart("character",-t.value.length),e.text.length-a+a}return t.selectionStart||"0"==t.selectionStart?t.selectionEnd:0},operationForBackspace:function(){var t,e,a=this.$node.querySelector(".lyteCalculatorTextField"),r=this.getData("ltPropEditable");r?(t=a.value,a.focus(),e=this.getSelectionIndex()):e=(t=a.innerHTML).length;var s=this.convertToPiandRoot(t);e=t.length-e;var n,i=s.split(/(p|Rand|e|arcsinh\(|arccosh\(|arctanh\(|arcsin\(|ln\(|arccos\(|arctan\(|sinh\(|cosh\(|tanh\(|sin\(|cos\(|tan\(|logy\(|log\(|sqrt\(|N\(|\(|\)|\+|\-|\|*|\^|!|%)/g).filter(function(t){return""!=t}),o=0;for(n=i.length-1;n>=0&&o!==e;n--)o+=i[n].length;if(n>=0){r&&this.setData("cursorIndex",this.getData("cursorIndex")-i[n].length),i.splice(n,1),i=i.join("");var l=String.fromCharCode(parseInt("221A",16)),c=String.fromCharCode(parseInt("03C0",16));i=(i=i.replace(/p/g,c)).replace(/N/g,l),r?a.value=i:a.innerHTML=i}},operationForDot:function(t){var e,a,r=this.$node.querySelector(".lyteCalculatorTextField");this.getData("ltPropEditable")?(e=r.value,r.focus(),a=this.getSelectionIndex()):a=(e=r.innerHTML).length;var s=this.convertToPiandRoot(e);a=e.length-a;var n,i=s.split(/([0-9.]+|p|Rand|e|arcsinh\(|arccosh\(|arctanh\(|arcsin\(|ln\(|arccos\(|arctan\(|sinh\(|cosh\(|tanh\(|sin\(|cos\(|tan\(|logy\(|log\(|sqrt\(|N\(|\(|\)|\+|\-|\|*|\^|!|%)/g).filter(function(t){return""!=t}),o=0;for(n=i.length-1;n>=0&&!(o>=a);n--)o+=i[n].length;if(n+1===i.length&&o===a){if(i[n].match(/[.]/g))return!0}else if(n>=1&&o===a&&i[n+1].match(/([0-9])/)){if(i[n+1].match(/[.]/g))return!0}else if(n>=0&&o===a&&!i[n+1].match(/([0-9])/)){if(i[n].match(/[.]/g))return!0}else if(o>a){if(i[n+1].match(/[.]/g))return!0}else if(0===n&&o===a&&i[n].match(/[.]/g))return!0;return!1},operationForZero:function(t){var e,a,r=this.$node.querySelector(".lyteCalculatorTextField");this.getData("ltPropEditable")?(e=r.value,r.focus(),a=this.getSelectionIndex()):a=(e=r.innerHTML).length;var s=this.convertToPiandRoot(e);a=e.length-a;var n,i=s.split(/([0-9.]+|p|Rand|e|arcsinh\(|arccosh\(|arctanh\(|arcsin\(|ln\(|arccos\(|arctan\(|sinh\(|cosh\(|tanh\(|sin\(|cos\(|tan\(|logy\(|log\(|sqrt\(|N\(|\(|\)|\+|\-|\|*|\^|!|%)/g).filter(function(t){return""!=t}),o=0;for(n=i.length-1;n>=0&&!(o>=a);n--)o+=i[n].length;if(n>=0&&o===a){if(parseInt(i[n])+""=="0"&&!i[n].match(/[.]/g))return!0}else if(a>0&&o>a&&parseInt(i[n+1])+""=="0"&&!i[n+1].match(/[.]/g))return!0;return!1},operationForArrowLeft:function(t){var e,a=this.$node.querySelector(".lyteCalculatorTextField"),r=a.value;a.focus(),e=this.getSelectionIndex();var s,n=this.convertToPiandRoot(r).split(/([0-9.]|p|Rand|e|arcsinh\(|arccosh\(|arctanh\(|arcsin\(|ln\(|arccos\(|arctan\(|sinh\(|cosh\(|tanh\(|sin\(|cos\(|tan\(|logy\(|log\(|sqrt\(|N\(|\(|\)|\+|\-|\|*|\^|!|%)/g).filter(function(t){return""!=t}),i=0;for(s=0;s<n.length-1&&(n[s+1]&&i+n[s].length<e);s++)i+=n[s].length;0==s&&(i=0),this.setData("cursorIndex",i+1),a.setSelectionRange(this.getData("cursorIndex"),this.getData("cursorIndex"))},operationForArrowRight:function(t){var e,a=this.$node.querySelector(".lyteCalculatorTextField"),r=a.value;a.focus(),e=this.getSelectionIndex();var s,n=this.convertToPiandRoot(r),i=n.split(/([0-9.]|p|Rand|e|arcsinh\(|arccosh\(|arctanh\(|arcsin\(|ln\(|arccos\(|arctan\(|sinh\(|cosh\(|tanh\(|sin\(|cos\(|tan\(|logy\(|log\(|sqrt\(|N\(|\(|\)|\+|\-|\|*|\^|!|%)/g).filter(function(t){return""!=t}),o=0;for(s=0;s<i.length&&o+i[s].length<=e;s++)o+=i[s].length;s==i.length?o=n.length:o+=i[s].length,this.setData("cursorIndex",o-1),a.setSelectionRange(this.getData("cursorIndex"),this.getData("cursorIndex"))},preformMouseDown:function(t){if(this.keyDown(t),!this.getData("pressedKey"))return!1;var e,a,r,s=String.fromCharCode(parseInt("221A",16)),n=String.fromCharCode(parseInt("03C0",16)),i=this.$node.querySelector(".lyteCalculatorTextField"),o=t||window.event,l=this.getTargetKey(o.target).textContent.replace(/\s*/g,""),c=this.getData("keyBoard")[l],h=this.getData("secondKeySet"),u=this.getData("secondLayer"),p=(this.getData("secondValue"),this.getData("ltPropEditable"));if(p?(i.focus(),e=this.getSelectionIndex(),f=i.value):(e=(f=i.innerHTML).length,$L.fastdom.measure(function(){if(i){var t=i.offsetWidth,e=i.scrollWidth;$L.fastdom.mutate(function(){i.scrollLeft=e-t}.bind(this))}}.bind(this))),a=this.getData("cursorIndex"),r=this.convertToPiandRoot(f),null===c&&"undefined"===c||(text=c.innerText,this.setData("previous",text)),-1!==this.$node.querySelector(".calculatorDisplay").className.indexOf("equalBtn")&&this.$node.querySelector(".calculatorDisplay").classList.remove("equalBtn"),-1!==c.className.indexOf("calculatorsmaller")||-1!==c.className.indexOf("calculatorToggle"))return this.setData("bigger",!this.getData("bigger")),this.getData("bigger")?(this.$node.querySelector(".basicCalculator").classList.add("anim"),this.$node.querySelector(".lyteCalculator").classList.remove("basic"),this.$node.querySelector(".lyteCalculator").classList.add("advanced")):(this.$node.querySelector(".basicCalculator").classList.remove("anim"),this.$node.querySelector(".lyteCalculator").classList.remove("advanced"),this.$node.querySelector(".lyteCalculator").classList.add("basic")),this.$node.querySelector(".calculatorrad").innerHTML=this.getData("bigger")?"Rad":"",this.getData("bigger")||this.setData("deg",!1),void this.keyUp();if(f.length>0&&(!text.match(/[0-9|.]/)||"1/x"==text||"10x"==text)&&"C"!=text&&"AC"!=text&&"."==f[f.length-1]?(f+="0",p?i.value=f:i.innerHTML=f,r=this.convertToPiandRoot(f),this.setData("cursorIndex",this.getData("cursorIndex")+1),a+=1,e+=1,this.preformMouseUp()):"10x"==text&&""!==f&&f[e-1]&&f[e-1].match(/([0-9])/g)&&(f+="*",p?i.value=f:i.innerHTML=f,r=this.convertToPiandRoot(f),this.setData("cursorIndex",this.getData("cursorIndex")+1),a+=1,e+=1,this.preformMouseUp()),"Rand"===text&&0!==e&&f.length>e&&r[e-1].match(/([0-9|e|p|.])/)&&(r[e].match(/([0-9|e|p])/)||f[e]===n)){var d=Math.random().toPrecision(11)+"";return this.setData("cursorIndex",a+d.length+1),f=f.substring(0,e)+"*"+d+"*"+f.substring(e,f.length+2),p?i.value=f:i.innerHTML=f,this.preformMouseUp(),void this.keyUp()}if("Rand"===text&&0!==e&&f.length>=1&&r[e-1]&&r[e-1].match(/([0-9|e|p|.])/)){d=Math.random().toPrecision(11)+"";return this.setData("cursorIndex",a+d.length+1),f=f.substring(0,e)+"*"+d+f.substring(e,f.length+1),p?i.value=f:i.innerHTML=f,this.preformMouseUp(),void this.keyUp()}if("Rand"===text&&f.length>e&&f[e]&&r[e].match(/([0-9|e|p|.])/)){d=Math.random().toPrecision(11)+"";return this.setData("cursorIndex",a+d.length+1),f=f.substring(0,e)+d+"*"+f.substring(e,f.length+1),p?i.value=f:i.innerHTML=f,this.preformMouseUp(),void this.keyUp()}if("Rand"===text){d=Math.random().toPrecision(11)+"";return f=f.substring(0,e)+d+f.substring(e,f.length),p?i.value=f:i.innerHTML=f,this.preformMouseUp(),this.setData("cursorIndex",a+d.length),void this.keyUp()}if("1/x"===text&&f.length>=1&&f[e-1]&&r[e-1].match(/([0-9|e|p])/))return text="*1/",f=f.substring(0,e)+text+f.substring(e,f.length),p?i.value=f:i.innerHTML=f,this.preformMouseUp(),this.setData("cursorIndex",a+text.length),void this.keyUp();var g=this.convertequation(f);if(g=(g=g.replace(/^[a-z][(]/,"")).split(/([0-9.]+|\(|\)|\+|\-|\/|\*|\^|~|N|s|c|t|l|S|C|T|!|%|L|i|o|a|I|O|A|G|E|p|R|e|Q)/g).filter(function(t){return""!=t}),0!=f.length&&"."===text){if(this.operationForDot())return void this.keyUp()}else if(0!=f.length&&"0"===text){if(this.operationForZero())return void this.keyUp()}else if("="===text)return this.$node.querySelector(".calculatorDisplay").classList.add("equalBtn")," "==this.$node.querySelector(".calculatorDispspan").innerHTML&&(this.$node.querySelector(".calculatorDispspan").innerHTML="Error"),-1==i.className.indexOf("hideCursor")&&i.classList.add("hideCursor"),void this.keyUp();if("C"===text){this.operationForBackspace();var f;i=this.$node.querySelector(".lyteCalculatorTextField");(f=p?i.value:i.innerHTML).length>=1?this.preformMouseUp():f.length<1&&this.clearValue(),this.keyUp()}else{if("AC"===text)return this.clearValue(),void this.keyUp();if("-"===text&&g.length>=2&&f[e-2]&&"-"===f[e-1]&&!r[e-2].match(/[0-9|p|e]/))return void this.keyUp();if("E"===text&&g.length>=1&&f[e-1]&&r[e-1].match(/[!||p|e]/))return void this.keyUp()}if(0!==e||!text.match(/^[+|/|*|!|E|%|.]+$/)&&"logy"!==text&&"xry"!==text&&"x2"!==text&&"xy"!=text){if(""!==f&&e-1!=-1&&"."===f[e-1]&&"."===text)return this.preformMouseUp(),void this.keyUp();if(""!==f&&e-1!=-1&&"E"===f[e-1]&&text.match(/([^0-9])/g))this.keyUp();else if(1!=e||"-"!=f[e-1]||!text.match(/^[+|-|/|*|!|%|E]+$/)&&"logy"!==text&&"xy"!=text){if(""===f||e-1==-1||!f[e-1]||!r[e-1].match(/^[+|\-|/|*|E|^]+$/)&&"logy("!==f.substring(e-5,e)||!text.match(/^[+|-|/|*|!|%|E]+$/)&&"logy"!==text&&"xy"!=text){if(""!==f&&e-1!=-1&&f[e-1]&&(r[e-1].match(/([^0-9-%ep!)])/g)||"Rand"===f.substring(e-4,e))&&(text.match(/^[+|-|/|*|!|%|E]+$/)||"logy"===text||"xry"===text||"x2"===text||"xy"===text))return void this.keyUp();if("="===text)return void this.keyUp();if(!text.match(/^m[c|+|-|r]/)&&"AC"!=text&&"C"!=text&&"2nd"!=text&&"Deg"!=text&&"Rad"!=text&&"="!=text&&"m-"!=text&&">"!=text)return"xry"===text?text=s:"p"===text?text=n:"1/x"===text?text="1/":"10x"===text?text="10^":"ex"===text?text="e^":"xy"===text?text="^":"x2"===text?text="^2":"sin-1"===text?text="arcsin":"cos-1"===text?text="arccos":"tan-1"===text?text="arctan":"sinh-1"===text?text="arcsinh":"cosh-1"===text?text="arccosh":"tanh-1"===text&&(text="arctanh"),(text.match(/^[sin|cos|tan|sinh|cosh|tanh|logy|log|ln|arcsin|arccos|arctan|arcsinh|arccosh|arctanh|sqrt|N]+$/)||text==s)&&(text+="("),f.length===e?p?i.value+=text:i.innerHTML+=text:(f=f.substring(0,e)+text+f.substring(e,f.length),p?i.value=f:i.innerHTML=f),this.setData("cursorIndex",a+text.length),this.setData("check_error",!1),this.preformMouseUp(),void this.keyUp();if(text.match(/^m[c|+|-|r]/)||"m-"===text)return this.memoryoperations(text),void this.keyUp();if("Deg"===text||"Rad"===text)return this.$node.querySelector(".calculatorrad").innerHTML=this.getData("deg")?"Rad":"Deg",this.$node.querySelector(".Deg").innerHTML=this.getData("deg")?"Deg":"Rad",this.setData("deg",!this.getData("deg")),""!==(f=p?this.$node.querySelector(".lyteCalculatorTextField").value:this.$node.querySelector(".lyteCalculatorTextField").innerHTML)&&this.preformMouseUp(),void this.keyUp();if("2nd"===text){var y=this.getData("secondActive");y=!y,this.setData("secondActive",y),c.className=y?"calc-second":"";for(var x=h.length;x--;)h[x].innerHTML=u[y?1:0][x],y?h[x].classList.add("inverse"):h[x].classList.remove("inverse");return this.setData("secondKeySet",h),void this.keyUp()}}else"logy"==text&&(text+="("),"xy"==text&&(text="^"),"logy("===f.substring(e-5,e)&&"logy("!==text?(f=f.substring(0,e-5)+text+f.substring(e,f.length),p?i.value=f:i.innerHTML=f,this.preformMouseUp(),this.keyUp(),this.setData("cursorIndex",a-5)):"logy("!==f.substring(e-5,e)&&(f=f.substring(0,e-1)+text+f.substring(e,f.length),p?i.value=f:i.innerHTML=f,this.preformMouseUp(),this.keyUp(),this.setData("cursorIndex",a-1)),this.setData("cursorIndex",this.getData("cursorIndex")+text.length);this.keyUp()}else this.keyUp()}else this.keyUp()},actions:{mousedown:function(t){var e,a=this.$node.querySelector(".lyteCalculatorTextField"),r=this.getData("ltPropEditable");-1!=a.className.indexOf("hideCursor")&&a.classList.remove("hideCursor"),this.getData("ltPropEditable")||a.classList.add("hideCursorNonEditable"),this.setData("check_error",!1),r?(a.focus(),e=this.getSelectionIndex()):e=a.innerHTML.length,this.setData("cursorIndex",e),this.preformMouseDown(t)},mouseup:function(t){var e=this.$node.querySelector(".lyteCalculatorTextField"),a=this.getData("ltPropEditable");a?(e.value,e.focus()):e.innerHTML,a&&"Rand"!=t.key&&(e.setSelectionRange(this.getData("cursorIndex"),this.getData("cursorIndex")),e.focus())},keydown:function(t){var e,a,r=t.key,s=this.$node.querySelector(".lyteCalculatorTextField"),n=this.getData("ltPropEditable");if(n?(a=s.value,s.focus(),e=this.getSelectionIndex(),s.classList.add("hideCursor")):(e=(a=s.innerHTML).length,$L.fastdom.measure(function(){if(s){var t=s.offsetWidth,e=s.scrollWidth;$L.fastdom.mutate(function(){s.scrollLeft=e-t}.bind(this))}}.bind(this))),this.setData("check_error",!1),this.setData("cursorIndex",e),"Backspace"===r)return this.operationForBackspace(),void t.preventDefault();if(this.getData("ltPropEditable")&&37===t.which)this.operationForArrowLeft();else if(this.getData("ltPropEditable")&&39===t.which)this.operationForArrowRight();else if(this.getData("bigger")||"^"!==r&&!r.match(/([^0-9/%*+-.])/g)&&","!==r||"Backspace"==r||"Enter"===r||38===t.which&&40===t.which)if(!this.getData("bigger")||!r.match(/([^0-9/()%^!*+-.])/g)&&","!==r||"Backspace"===r||"Enter"===r||38===t.which&&40===t.which){if("Backspace"!=r&&"Enter"!=r){var i=this.convertequation(a),o=this.convertToPiandRoot(a);if(i=(i=i.replace(/^[a-zA-Z][(]/,"")).split(/([0-9.]+|\(|\)|\+|\-|\/|\*|\^|~|N|s|c|t|l|S|C|T|!|%|L|i|o|a|I|O|A|G|E|p|R|e|Q)/g).filter(function(t){return""!=t}),a.length>0&&(!r.match(/[0-9|.]/)||"1/x"==r||"10x"==r)&&"C"!=r&&"AC"!=r&&"."==a[a.length-1]&&(a+="0",n?s.value=a:s.innerHTML=a,o=this.convertToPiandRoot(a),this.setData("cursorIndex",this.getData("cursorIndex")+1),cursorIndex+=1,e+=1,this.preformMouseUp()),0!==a.length&&"."===r){if(this.operationForDot())return void t.preventDefault()}else if(0!==a.length&&"0"===r){if(this.operationForZero())return void t.preventDefault()}else{if(1==e&&"-"==a[e-1]&&(r.match(/^[+|-|/|*|!|%|E]+$/)||"logy"===r||"xy"==r))return void t.preventDefault();if("-"===r&&i.length>=2&&"-"===a[e-1]&&!o[e-2].match(/[0-9|p|e]/))return void t.preventDefault()}if((0===a.length||0===e)&&r.match(/^[+|/|*|!|%|.|^]+$/))return void t.preventDefault();if(""!==a&&e-1!=-1&&"."===a[e-1]&&"."===r)return void t.preventDefault();""===a||e-1==-1||!a[e-1].match(/^[+|\-|/|*|E|\^]+$/)&&"logy("!==a.substring(e-5,e)||!r.match(/^[+|-|/|*|!|%|E|\^]+$/)&&"logy"!==r?n||(s.innerHTML+=r):("logy"===r&&(r+="("),"logy("===a.substring(e-5,e)&&"logy("!==r?(a=a.substring(0,e-5)+r+a.substring(e,a.length),n?s.value=a:s.innerHTML=a,this.setData("cursorIndex",this.getData("cursorIndex")-5),t.preventDefault()):"logy("!==a.substring(e-5,e)&&(a=a.substring(0,e-1)+r+a.substring(e,a.length),n?s.value=a:s.innerHTML=a,this.setData("cursorIndex",this.getData("cursorIndex")-1),t.preventDefault())),this.setData("cursorIndex",this.getData("cursorIndex")+r.length)}}else t.preventDefault();else t.preventDefault()},keyup:function(t){var e,a=t.key,r=this.$node.querySelector(".lyteCalculatorTextField"),s=this.getData("ltPropEditable");if(this.setData("check_error",!1),e=this.getData("ltPropEditable")?r.value:r.innerHTML,this.getData("ltPropEditable")&&37==t.which)return t.preventDefault(),void r.classList.remove("hideCursor");if(this.getData("ltPropEditable")&&37==t.which)return t.preventDefault(),void r.classList.remove("hideCursor");if(!(this.getData("bigger")||"^"!==a&&!a.match(/([^0-9/%*+-=.])/g)||"Backspace"===a||"Enter"===a||37==t.which&&39==t.which&&38===t.which&&40===t.which))return s&&r.classList.remove("hideCursor"),this.setData("cursorIndex",this.getData("cursorIndex")),void t.preventDefault();if(!(!this.getData("bigger")||!a.match(/([^0-9/()%^!*+-=.])/g)||187!==t.keyCode&&61===t.keyCode||t.shiftKey||"Backspace"===a||"Enter"===a||37==t.which&&39==t.which&&38===t.which&&40===t.which))return r.classList.remove("hideCursor"),this.setData("cursorIndex",this.getData("cursorIndex")),void t.preventDefault();if(e.length>=1){if(-1!=this.$node.querySelector(".calculatorDisplay").className.indexOf("equalBtn")&&this.$node.querySelector(".calculatorDisplay").classList.remove("equalBtn"),"Backspace"===a)s&&(r.setSelectionRange(this.getData("cursorIndex"),this.getData("cursorIndex")),r.classList.remove("hideCursor")),this.preformMouseUp();else{if("="===a||"Enter"===a){var n=this.convertequation(e);return n=(n=n.replace(/^[a-zA-Z][(]/,"")).split(/([0-9.]+|\(|\)|\+|\-|\/|\*|\^|~|N|s|c|t|l|S|C|T|!|%|L|i|o|a|I|O|A|G|E|p|R|e|Q)/g).filter(function(t){return""!=t}),this.$node.querySelector(".calculatorDisplay").classList.add("equalBtn"),this.$node.querySelector(".calculatorDisplay").classList.add("equalBtn"),void(" "==this.$node.querySelector(".calculatorDispspan").innerHTML&&(this.$node.querySelector(".calculatorDispspan").innerHTML="Error"))}s&&(r.setSelectionRange(this.getData("cursorIndex"),this.getData("cursorIndex")),r.classList.remove("hideCursor"))}this.setData("previous",a),this.preformMouseUp()}else s&&r.classList.remove("hideCursor"),this.clearValue()},mupTextField:function(t){var e=this.$node.querySelector(".lyteCalculatorTextField"),a=e.value,r=this.convertToPiandRoot(a);if(-1!=this.$node.querySelector(".calculatorDisplay").className.indexOf("equalBtn")&&this.$node.querySelector(".calculatorDisplay").classList.remove("equalBtn"),!this.getData("ltPropEditable"))return e.setSelectionRange(a.length,a.length),void t.preventDefault();if(e.value.length>=1){if(e.focus(),index=this.getSelectionIndex(),0!==index&&!r[index-1].match(/^[+|\-|/|*|!|^|(|e|p|)|E|%]+$/)&&!r[index-1].match(/[0-9.]/g)&&a.length!==index)return e.setSelectionRange(a.length,a.length),e.classList.remove("hideCursor"),void t.preventDefault();e.classList.remove("hideCursor")}e.classList.remove("hideCursor")},mdwnTextField:function(t){var e=this.$node.querySelector(".lyteCalculatorTextField");e.classList.add("hideCursor"),this.getData("ltPropEditable")||-1!==e.className.indexOf("hideCursorNonEditable")||e.classList.add("hideCursorNonEditable")}}});