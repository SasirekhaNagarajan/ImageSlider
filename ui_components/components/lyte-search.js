Lyte.Component.register("lyte-search",{_template:'<template tag-name="lyte-search">\n    <lyte-input lt-prop-auto-update="{{ltPropAutoUpdate}}" lt-prop-tab-index="{{ltPropTabIndex}}" lt-prop-id="{{ltPropId}}" lt-prop-wrapper-style="{{ltPropWrapperStyle}}" lt-prop-class="{{ltPropClass}}" lt-prop-autofocus="{{ltPropAutofocus}}" lt-prop-autocomplete="{{ltPropAutocomplete}}" lt-prop-type="{{ltPropType}}" lt-prop-name="{{ltPropName}}" lt-prop-placeholder="{{ltPropPlaceholder}}" lt-prop-width="{{ltPropWidth}}" lt-prop-height="{{ltPropHeight}}" onkeyup="{{action(\'keyup\', event, this)}}" lt-prop-style="{{ltPropStyle}}" lt-prop-value="{{lbind(ltPropValue)}}" onkeypress="{{action(\'keypress\', event, this)}}" lt-prop-appearance="{{ltPropAppearance}}" lt-prop-direction="{{ltPropDirection}}" lt-prop-disabled="{{ltPropDisabled}}" lt-prop-readonly="{{ltPropReadonly}}" on-value-change="{{method(\'valuechange\')}}" on-focus="{{method(\'focus\')}}" on-blur="{{method(\'blurEvent\')}}" lt-prop-input-title="{{ltPropInputTitle}}" lt-prop-pattern="{{ltPropPattern}}" lt-prop-maxlength="{{ltPropMaxlength}}" oninput="{{action(\'input\', event)}}" lt-prop-close-icon="{{ltPropCloseIcon}}" is-search="true" lt-prop-update-delay="{{ltPropUpdateDelay}}"></lyte-input>\n</template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}],_observedAttributes:["ltPropAutocomplete","ltPropPlaceholder","ltPropAutofocus","ltPropDisabled","ltPropStyle","ltPropMaxlength","ltPropReadonly","ltPropId","ltPropClass","ltPropType","ltPropName","ltPropWidth","ltPropHeight","ltPropValue","ltPropAppearance","ltPropDirection","ltPropQuerySelector","ltPropMinLength","ltPropMethod","ltPropWrapperStyle","ltPropTabIndex","ltPropAjaxRequest","ltPropAutoUpdate","ltPropPattern","ltPropInputTitle","ltPropCloseIcon","ltPropUpdateDelay","ltPropSearchDelay","ltPropComponent","timeout"],init:function(){this.getMethods("beforeRender")&&this.executeMethod("beforeRender",this.$node)},didConnect:function(){this.$node.setValue=function(t,e){this.$node.ltProp("value",t),this.pressFunc(t||"",e||{})}.bind(this),this.getMethods("afterRender")&&this.executeMethod("afterRender",this.$node),["focus","blur","click","select"].forEach(function(t){this.$node[t]=function(e){this.$node.querySelector("lyte-input")[t](e)}.bind(this)}.bind(this)),$L.fastdom.measure(function(){_lyteUiUtils.getRTL()&&$L.fastdom.mutate(function(){this.$node.classList.add("lyteRTL")}.bind(this))}.bind(this));var t=this.data.ltPropComponent,e=this.data.ltPropQuerySelector;"accordion"==t?e.related="lyte-accordion-item":"tree"==t&&(e.related=".lyteTreeBodyDiv lyte-yield:not(.noChildClass) lyte-tree-icon")},didDestroy:function(){clearTimeout(this._comptime),delete this.$node.setValue,delete this.$node.focus,delete this.$node.blur,delete this.$node.click,delete this.$node.select},data:function(){return{ltPropAutocomplete:Lyte.attr("string",{default:"off"}),ltPropPlaceholder:Lyte.attr("string",{default:""}),ltPropAutofocus:Lyte.attr("boolean",{default:!1}),ltPropDisabled:Lyte.attr("boolean",{default:!1}),ltPropStyle:Lyte.attr("string",{default:""}),ltPropMaxlength:Lyte.attr("number",{default:25}),ltPropReadonly:Lyte.attr("boolean",{default:!1}),ltPropId:Lyte.attr("string",{default:"inputId"}),ltPropClass:Lyte.attr("string",{default:""}),ltPropType:Lyte.attr("string",{default:"search"}),ltPropName:Lyte.attr("string",{default:""}),ltPropWidth:Lyte.attr("string",{default:"100%"}),ltPropHeight:Lyte.attr("string",{default:""}),ltPropValue:Lyte.attr("string",{default:""}),ltPropAppearance:Lyte.attr("string",{default:"flat"}),ltPropDirection:Lyte.attr("string",{default:"vertical"}),ltPropQuerySelector:Lyte.attr("object",{default:{}}),ltPropMinLength:Lyte.attr("number",{default:1}),ltPropMethod:Lyte.attr("string",{default:"contains"}),ltPropWrapperStyle:Lyte.attr("string",{default:""}),ltPropTabIndex:Lyte.attr("string",{default:"0"}),ltPropAjaxRequest:Lyte.attr("object",{default:{}}),ltPropAutoUpdate:Lyte.attr("boolean",{default:!0}),ltPropPattern:Lyte.attr("string",{default:".+"}),ltPropInputTitle:Lyte.attr("string",{default:""}),ltPropCloseIcon:Lyte.attr("boolean",{default:!1}),ltPropUpdateDelay:Lyte.attr("number",{default:250}),ltPropSearchDelay:Lyte.attr("number",{default:100}),ltPropComponent:Lyte.attr("string",{default:void 0}),timeout:Lyte.attr("number",{default:void 0})}},methods:{blurEvent:function(t){this.getMethods("onBlur")&&this.executeMethod("onBlur",t,this.$node)},focus:function(t){this.getMethods("onFocus")&&this.executeMethod("onFocus",t,this.$node)},valuechange:function(t){this.getMethods("onValueChange")&&this.executeMethod("onValueChange",t,this.$node)}},searchList:function(t){var e=[],r=[];query=this.getData("ltPropQuerySelector"),"string"==typeof query&&(query=JSON.parse(query));for(var o=0;o<t.childElementCount;o++){for(;t.children[o].childElementCount;){returnedVal=this.searchList.call(this,t.children[o]),e=e.concat(returnedVal[0]),r=r.concat(returnedVal[1]);break}if(!t.children[o].childElementCount)if(e.push(t.children[o].textContent),query.target){var l="string"==typeof query.scope?document.body.querySelector(query.scope.trim()):query.scope;for(targetList=l.querySelectorAll(query.target),node=t.children[o];node!=l;){for(var a=!1,i=0;i<targetList.length;i++)if(node==targetList[i]){r.push(node),a=!0;break}if(a)break;node=node.parentElement}}else r.push(t.children[o])}return[e,r]},actions:{"on-ip-clear":function(t){this.$node.setValue("",{type:"clear"})},keypress:function(t){var e=t.keyCode;e>=37&&e<=40||13==e||t.stopPropagation()},keyup:function(t,e){var r=t.which||t.keyCode;if(!([37,13,38,39,40,27].indexOf(r)>-1)){clearTimeout(this.data.timeout),clearTimeout(this._iptime);var o=this.$node.querySelector("input,textarea").value;if(o.length>=this.getData("ltPropMinLength")||8==t.keyCode||91==t.keyCode||17==t.keyCode){var l=this.data.ltPropSearchDelay;void 0!=l?this.timeout=setTimeout(this.pressFunc.bind(this),l,o,t):this.pressFunc.call(this,o,t)}}},input:function(t){clearTimeout(this._iptime),this._iptime=setTimeout(this.pressFunc.bind(this),250,t.target.value,t)}},filteringArray:function(t,e,r,o,l,a){var i=this.getData("ltPropMethod"),s=[],n=[];if((r=r.toLowerCase()).length)for(var c=0;c<t.length;c++){this.switchfn(i,r,t[c].trim().toLowerCase())?s.push(o[c]):n.push(o[c])}else s=Array.apply(Array,o);this.getMethods("onSearch")&&0==this.executeMethod("onSearch",s,this.$node,l&&"clear"==l.type?{}:l,r,n)||(void 0==this.data.ltPropSearchDelay?this.hideProcess(t,e,i,r,a,l,n,s):$L.fastdom.mutate(this.hideProcess.bind(this,t,e,i,r,a,l,n,s)))},switchfn:function(t,e,r){var o;switch(t){case"contains":o=r.indexOf(e.toLowerCase())>=0;break;case"startsWith":o=0==r.indexOf(e.toLowerCase());break;case"endsWith":var l=r.lastIndexOf(e.toLowerCase());-1!=l&&(o=l+e.length==r.length)}return o},hideProcess:function(t,e,r,o,l,a,i,s){for(var n=this.data.ltPropQuerySelector,c=(o=o.toLowerCase(),0);c<t.length;c++)this.additionalHand(e[c],this.switchfn(r,o,t[c].trim().toLowerCase()));for(c=0;c<l.length;c++){if("accordion"==this.data.ltPropComponent&&void 0==l[c]._state){if(!l[c].querySelector("lyte-accordion-body")){o?l[c].classList.add("lyteSearchHidden"):l[c].classList.remove("lyteSearchHidden");continue}l[c]._state=l[c].classList.contains("lyteAccordionActive")}else if("tree"==this.data.ltPropComponent){void 0==l[c]._state&&(l[c]._state=l[c].classList.contains("lyteIconOpened"));continue}l[c].querySelectorAll(n.target||n.search).length==l[c].querySelectorAll(".lyteSearchHidden").length?l[c].classList.add("lyteSearchHidden"):l[c].classList.remove("lyteSearchHidden")}"accordion"==this.data.ltPropComponent?$L.fastdom.measure(this.accfilter.bind(this,s,i,o,a&&"clear"==a.type)):"tree"==this.data.ltPropComponent&&$L.fastdom.measure(this.treefilter.bind(this,s,i,o,a&&"clear"==a.type))},accfilter:function(t,e,r,o){for(var l=$L(this.data.ltPropQuerySelector.scope),a=0;a<t.length;a++){for(var i=$L(t[a]).closest("lyte-accordion-item",l),s=0;s<e.length;s++){var n=$L(e[s]).closest("lyte-accordion-item",l);i[0]!=n[0]||(Lyte.arrayUtils(e,"removeAt",s),s--)}if(t[a+1]){n=$L(t[a+1]).closest("lyte-accordion-item",l);i[0]==n[0]&&(Lyte.arrayUtils(t,"removeAt",a+1),a--)}}$L.fastdom.mutate(function(){for(var l=0;l<t.length;l++){var a=!1;a=!(s=$L(t[l]).closest("lyte-accordion-item")).hasClass("lyteAccordionActive"),r||(a=void 0!=s[0]._scope?!a&&!s[0]._scope:!a),a&&s.click()}for(var i=0;i<e.length;i++){var s=$L(e[i]).closest("lyte-accordion-item");o?!s[0]._state&&s.hasClass("lyteAccordionActive")&&s.click():s.hasClass("lyteAccordionActive")&&s.click()}})},treeinremove:function(t){for(var e=0;e<t.length;e++)if(t[e+1]){var r=$L(t[e]).closest(".lyteTreeBodyDiv")[0],o=$L(t[e+1]).closest(".lyteTreeBodyDiv")[0];r.contains(o)?Lyte.arrayUtils(t,"removeAt",e+1):o.contains(r)&&(Lyte.arrayUtils(t,"removeAt",e),e--)}},treefilter:function(t,e,r,o){for(var l=$L(this.data.ltPropQuerySelector.scope)[0],a=0;a<t.length;a++){var i=$L(t[a]).closest(".lyteTreeBodyDiv");for(j=0;j<e.length;j++){var s=$L(e[j]).closest(".lyteTreeBodyDiv");i[0].contains(s[0])?(s.addClass("lyteSearchHidden"),Lyte.arrayUtils(e,"removeAt",j)):s[0].contains(i[0])&&(s.removeClass("lyteSearchHidden"),Lyte.arrayUtils(e,"removeAt",j))}}for(a=0;a<t.length;a++)this.removeClse(t[a],l),r.length&&l.ltProp("stateAttr",$L(t[a]).closest("lyte-tree-body").attr("data-value"));if(r.length)for(a=0;a<e.length;a++)$L(e[a]).closest(".lyteTreeBodyDiv").addClass("lyteSearchHidden");else this.hiderecurse($L("lyte-yield:not(.noChildClass) lyte-tree-icon",l),o)},removeClse:function(t,e){e=$L(this.data.ltPropQuerySelector.scope);var r=$L(t).closest(".lyteSearchHidden",e);r.length&&(r.removeClass("lyteSearchHidden"),this.removeClse(t,e))},hiderecurse:function(t,e){for(var r=t.length-1;r>=0;r--){var o=t.eq(r);e&&void 0!=o[0]._state?(o[0]._state&&!o.hasClass("lyteIconOpened")||!o[0]._state&&o.hasClass("lyteIconOpened"))&&setTimeout(o.click.bind(o),20):o.hasClass("lyteIconOpened")&&setTimeout(o.click.bind(o),20),delete o[0]._state}},additionalHand:function(t,e){var r=this.data.ltPropComponent,o=this.data.ltPropQuerySelector;o.scope.constructor==String?document.querySelector(o.scope):o.scope;if(e){if("dropdown"==r){var l=$L(t).closest("lyte-drop-box")[0];l&&l.classList.contains("lyteDropdownHidden")&&l.origindd.toggle()}t.classList.remove("lyteSearchHidden")}else if("tree"!=r){if(t.classList.contains("lyteSearchHidden"))return;t.classList.add("lyteSearchHidden")}},pressFunc:function(t,e){if(!this.getMethods("onBeforeSearch")||0!=this.executeMethod("onBeforeSearch",e,this)){var r,o=[],l=[],a=[],i=this.data.ltPropQuerySelector,s="string"==typeof i.scope?document.body.querySelector(i.scope.trim()):i.scope;if(i.search&&(l=s.querySelectorAll(i.search.trim())),a=i.target?s.querySelectorAll(i.target.trim()):l,i.search)for(var n=0;n<l.length;n++)o[n]=l[n].textContent;else returnedVal=this.searchList.call(this,s),o=returnedVal[0],l=(a=returnedVal[1]).slice();r=i.related&&(i.search||i.target)?r=s.querySelectorAll(i.related):[],this.filteringArray.call(this,o,a,t,l,e,r),this._prevVal=t}}});