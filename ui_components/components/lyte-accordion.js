Lyte.Component.register("lyte-accordion",{_template:'<template tag-name="lyte-accordion">\n\t<lyte-yield yield-name="yield">\n\n\t</lyte-yield>\n</template>',_dynamicNodes:[{type:"insertYield",position:[1]}],_observedAttributes:["ltPropDuration","ltPropHeight","ltPropExclusive","ltPropYield"],data:function(){return{ltPropDuration:Lyte.attr("string",{default:"0.2s"}),ltPropHeight:Lyte.attr("string"),ltPropExclusive:Lyte.attr("boolean",{default:!0}),ltPropYield:Lyte.attr("boolean",{default:!0})}},execAndCheck:function(e,t){var i,n;return i=_lyteAccordion.findProperParent(t.target).parentElement,n=void 0==(n=this.executeMethod(e,t,i,this))||n},initiateClose:function(e,t,i){e.style.height="0px",e.style.overflow="hidden",this.setData("close",!0),e.parentElement.classList.remove("lyteAccordionActive"),t&&$L.fastdom.measure(function(){t.call(this,i)},this)},execNonRetCalls:function(e){this.getMethods(e[0])&&this.executeMethod.apply(this,e)},scrollIntoView:function(e){if(e){var t,i=this.$node.getBoundingClientRect().height,n=this.$node.scrollTop+i,o=e.offsetTop,r=e.getAttribute("map"),a=o+e.getBoundingClientRect().height;n<a&&(this.$node.scrollTop=this.$node.scrollTop+(a-n)),t=window.requestAnimationFrame(this.scrollIntoView.bind(this,e)),Lyte.objectUtils(this.getData("rAFMap"),"add",r,t)}},initiateOpen:function(e,t,i){var n,o=t.height;this.getData("heights")[e.getAttribute("map")].conf&&o?e.style.height=o:e.style.height=this.getData("heights")[e.getAttribute("map")].height,this.setData("close",!1),e.parentElement.classList.add("lyteAccordionActive"),n=_lyteAccordion.findProperParent(i.target),$L.fastdom.measure(function(){this.scrollIntoView(e),this.execNonRetCalls(["onOpen",i,n.parentElement,this]),this.execNonRetCalls(["onChanged",i,n.parentElement,this])},this)},didDestroy:function(){for(var e=this.$node.querySelectorAll("lyte-accordion-item"),t=0;t<e.length;t++)e[t].getAttribute("lyte-shortcut")&&e[t].setAttribute("lyte-shortcut",JSON.stringify({}))},setEvent:function(e){var t=this;e.addEventListener("transitionend",function(){var i=e.getAttribute("map"),n=t.getData("close");window.cancelAnimationFrame(t.getData("rAFMap")[i]),e.style.overflow=n?"hidden":"auto"})},getAllHeights:function(){this.setData("heights",{}),$L.fastdom.measure(function(){for(var e,t,i=this.$node.querySelector("lyte-yield").children,n=0;n<i.length;n++)"LYTE-ACCORDION-ITEM"===i[n].tagName&&(e=i[n].querySelector("lyte-accordion-body"))&&(this.setEvent(e),t=e.style.height,this.getData("heights")[n]={},t?(this.getData("heights")[n].height=t,this.getData("heights")[n].conf=!1):(this.getData("heights")[n].height=e.getBoundingClientRect().height-parseFloat(window.getComputedStyle(e).paddingTop)-parseFloat(window.getComputedStyle(e).paddingBottom)+"px",this.getData("heights")[n].conf=!0),i[n].classList.contains("lyteAccordionActive")&&this.getData("ltPropExclusive")&&(this.flag=n))},this),$L.fastdom.mutate(function(){for(var e,t=this.$node.querySelector("lyte-yield").children,i=this.getData("ltPropExclusive"),n=0;n<t.length;n++)"LYTE-ACCORDION-ITEM"===t[n].tagName&&(e=t[n].querySelector("lyte-accordion-body"))&&(e.setAttribute("map",n),t[n].classList.contains("lyteAccordionActive")?i&&this.flag!=n?(t[n].classList.remove("lyteAccordionActive"),e.style.height="0px"):e.style.height=this.getData("heights")[n].conf&&this.getData("ltPropHeight")?this.getData("ltPropHeight"):this.getData("heights")[n].height:e.style.height="0px");$L.fastdom.measure(function(){this.execNonRetCalls(["afterRender",this])},this)},this)},didConnect:function(){this.setData("rAFMap",{}),this.getAllHeights()},getConfiguration:function(){var e={};return e.transition=this.getData("ltPropDuration"),e.height=this.getData("ltPropHeight"),e.exclusive=this.getData("ltPropExclusive"),e}});var _lyteAccordion={findProperParentS:function(e){for(var t,i,n=[],o=!1;"LYTE-YIELD"!=e.tagName&&"HTML"!=e.tagName;)if(t=e,n.push(e),!(e=e.parentElement))return null;for(i=n.length-1;i>-1;i--)if("LYTE-ACCORDION-HEADER"===n[i].tagName||1===n.length&&"LYTE-ACCORDION-ITEM"===n[i].tagName){o=!0;break}return o?t.children[0]:null},findProperParent:function(e){var t;if(e){for(;"LYTE-YIELD"!=e.tagName&&"HTML"!=e.tagName;)if(t=e,!(e=e.parentElement))return{};return t.children[0]}}};document.addEventListener("click",function(e){var t,i,n,o,r,a,l,s,c,h,d,g,u,f=_lyteAccordion.findProperParentS(e.target),y=0;if(f){for(t=f;"HTML"!=t.tagName&&"LYTE-ACCORDION"!=t.tagName;)if(!(t=t.parentElement))return;if("HTML"!=t.tagName){for(n=(i=t.querySelector("lyte-yield")).children,o=!0;y<n.length;y++)if(n[y].querySelector("lyte-accordion-header")==f){o=!1;break}if(!o){if(r=i.children[y].querySelector("lyte-accordion-body"),s=(l=(a=i.parentElement.component).getConfiguration()).transition,!r||"LYTE-ACCORDION-BODY"!=r.tagName){if(l&&l.exclusive&&(c=a.$node.querySelector(".lyteAccordionActive"))&&(h=c.querySelector("lyte-accordion-body")))if(h.style.transitionDuration=s,a.getMethods("onBeforeClose")){if(!(d=a.execAndCheck("onBeforeClose",e)))return;a.initiateClose(h,function(e){this.execNonRetCalls(["onClose",e,_lyteAccordion.findProperParent(e.target).parentElement,this])},e)}else a.initiateClose(h,function(e){this.execNonRetCalls(["onClose",e,_lyteAccordion.findProperParent(e.target).parentElement,this])},e);return i.children[y].classList.contains("lyteAccordionActive")?i.children[y].classList.remove("lyteAccordionActive"):i.children[y].classList.add("lyteAccordionActive"),void $L.fastdom.measure(function(){a.execNonRetCalls(["onChanged",e,_lyteAccordion.findProperParent(e.target).parentElement,a])})}if(g=window.getComputedStyle(r).height,s&&(r.style.transitionDuration=s,(c=a.$node.querySelector(".lyteAccordionActive"))&&(h=c.querySelector("lyte-accordion-body"))&&(h.style.transitionDuration=s)),u=a.$node.querySelector(".lyteAccordionActive"),l&&l.exclusive&&u&&u!=r.parentElement){if((h=u.querySelector("lyte-accordion-body"))&&a.getMethods("onBeforeClose")){if(!(d=a.execAndCheck("onBeforeClose",e)))return;a.initiateClose(h,function(e){this.execNonRetCalls(["onClose",e,_lyteAccordion.findProperParent(e.target).parentElement,this])},e)}else(h=u.querySelector("lyte-accordion-body"))&&a.initiateClose(h,function(e){this.execNonRetCalls(["onClose",e,_lyteAccordion.findProperParent(e.target).parentElement,this])},e);u.classList.contains("lyteAccordionActive")&&u.classList.remove("lyteAccordionActive")}if("0px"==g)if(a.getMethods("onBeforeOpen")){if(d=a.execAndCheck("onBeforeOpen",e),l=a.getConfiguration(),!d)return;a.initiateOpen(r,l,e)}else a.initiateOpen(r,l,e);else if(a.getMethods("onBeforeClose")){if(!(d=a.execAndCheck("onBeforeClose",e)))return;a.initiateClose(r,function(e){var t=_lyteAccordion.findProperParent(e.target);this.execNonRetCalls(["onClose",e,t.parentElement,this]),this.execNonRetCalls(["onChanged",e,t.parentElement,this])},e)}else a.initiateClose(r,function(e){var t=_lyteAccordion.findProperParent(e.target);this.execNonRetCalls(["onClose",e,t.parentElement,this]),this.execNonRetCalls(["onChanged",e,t.parentElement,this])},e)}}}},!0),Lyte.createCustomElement("lyte-accordion-item",{static:{observedAttributes:{get:function(){return["lyte-shortcut"]}}},attributeChangedCallback:function(e,t,i,n){if("function"==typeof shortcut){if(!i)return;if(!(i=JSON.parse(i)).key)return;var o=i.key,r=i.type,a=i.wait;t||(t={}),shortcut.push({newKey:o,type:r,wait:a,oldKey:t.key,value:this})}}});