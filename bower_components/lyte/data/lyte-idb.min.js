var worker=new Worker("lyte-idb-worker.js");worker.onmessage=function(e){var t=e.data;if(t)if("open"==t.type)void 0!=store.adapter.application&&store.adapter.application.differIDBAction||setTimeout(function(){LyteIDB.triggerIDBInsertion()},0);else if("completed4"==t.qProcess){var o=Object.keys(store.$.idbQ2)[0],r=t.data||[];r.forEach(function(e){var t=store.peekRecord(o,e);Lyte.isRecord(t)&&(t.$.inIDB=!0)}),delete store.$.idbQ2[o],LyteIDB.isProcessing=!1}else if(t.hasOwnProperty("code")){var s=t.req,a=LyteIDB[t.model][t.type],i="findRecord"==s?a[t.key].splice(0,1)[0]:a.splice(0,1)[0];200==t.code?i&&i.resolve&&i.resolve(t.data):400==t.code&&i&&i.reject&&i.reject(),0==a.length&&delete LyteIDB[t.model][t.type]}else if(t.pause){var i=LyteIDB[t.model][t.type],d=localStorage.getItem("pause");localStorage.setItem("pause",!d),i&&i.reject&&i.reject()}0==Object.keys(store.$.idbQ2).length&&(LyteIDB.isProcessing=!1)},window.addEventListener("load",function(){var e=[];for(var t in store.model){var o=store.model[t]._pK;e.push({modelName:t,pK:o})}var r,s=store.$.cbScp("app","idbBeforeOpen");s&&(r=store.$.consArg(e),e=store.$.cB(s,r));var a=window.location.host,i=localStorage.getItem("idb"+a);void 0==i?localStorage.setItem("idb"+a,1):(i=parseInt(i),localStorage.setItem("idb"+a,i+1)),localStorage.setItem("pause",!1),document.addEventListener("storage",function(){worker.postMessage({type:"close"})}),worker.postMessage({type:"open",models:e}),e=[]}),window.addEventListener("unload",function(){LyteIDB.removeIDBDatabase()});var LyteIDB={isProcessing:!1,removeIDBDatabase:function(){var e=window.location.host,t=localStorage.getItem("idb"+e);void 0==t||parseInt(t)-1==0?(indexedDB.deleteDatabase("lyte"),localStorage.removeItem("idb"+e)):localStorage.setItem("idb"+e,parseInt(t)-1)},postMessage:function(e){if(e.resolve&&e.reject){LyteIDB[e.model]=LyteIDB[e.model]||{};var t={key:e.key,resolve:e.resolve,reject:e.reject,queryParams:e.queryParams,req:e.req};if("findRecord"==e.req){var o=LyteIDB[e.model][e.type]=LyteIDB[e.model][e.type]||{},r=o[e.key]=o[e.key]||[];r.push(t)}else{var r=LyteIDB[e.model][e.type]=LyteIDB[e.model][e.type]||[];r.push(t)}delete e.resolve,delete e.reject}worker.postMessage(e)},IDBInsert:function(){var e=LyteIDB.isProcessing;if(!e&&Object.keys(store.$.idbQ2).length){LyteIDB.isProcessing=!0;for(var t,t=Object.keys(store.$.idbQ2)[0];t&&store.$.idbQ2[t]&&0==store.$.idbQ2[t].length;)delete store.$.idbQ2[t],t=Object.keys(store.$.idbQ2)[0];if(t){var o=store.$.idbQ2[t],r=store.modelFor(t)._pK;o.length?worker.postMessage({type:"push",module:t,data:o,pK:r}):delete store.$.idbQ2[t]}}0==Object.keys(store.$.idbQ2).length&&(LyteIDB.isProcessing=!1)},triggerIDBInsertion:function(){setInterval(function(){setTimeout(LyteIDB.IDBInsert,0)},10)}};