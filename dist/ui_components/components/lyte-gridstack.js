Lyte.Component.register("lyte-gridstack",{_template:'<template tag-name="lyte-gridstack">\n\t\t<lyte-yield yield-name="lyteGridStack">\n\t\t</lyte-yield>\n</template>',_dynamicNodes:[{type:"insertYield",position:[1]}],_observedAttributes:["ltPropScope","ltPropHandler","ltPropMarginLeft","ltPropMarginTop","ltPropUnitX","ltPropUnitY","ltPropResizeDirection","ltPropFloat","ltPropDirection","ltPropUndo","ltPropResize","ltPropBestfit","ltPropMinUnitX","ltPropMinMarginLeft","ltPropBestfitClass","ltPropFreezeMode","ltPropDefaultLength","ltPropDefaultHeight","ltPropDefaultMinLength","ltPropDefaultMinHeight","ltPropDefaultMaxHeight","ltPropDefaultMaxLength","ltPropColumnMode","ltPropColumn","ltPropPrevent","ltPropGridLength","ltPropBestfitType","ltPropForcedReposition","ltPropSquareGrid","ltPropGridSpaceColor","ltPropHitBottom","ltPropGridSelectionClass","ltPropVisibleBoundary","ltPropVisible","gridLength","ltPropGridHeight","ltPropMarginLeftCopy","ltPropUnitXCopy","lyteGridStack","elements","oriNode","xElements","yElements","iniData","lyteQuerySelector","direction"],init:function(){var t=navigator.userAgent;this.isSaf={safari:!!window.safari,isIE11Lyte:/rv:11/gi.test(t),isEdgeLyte:/Edge/gi.test(t),chrome:!!window.chrome,firefox:/firefox/gi.test(t)},this._childGrids=[],this.freeezeModeObs.call(this,this.data.ltPropFreezeMode),this.getMethods("beforeRender")&&this.executeMethod("beforeRender",this.$node)},didDestroy:function(){if(document.removeEventListener("keydown",this.data.lyteQuerySelector.keydown),window.removeEventListener("resize",this._resizeFunc,!0),document.removeEventListener("click",this._click),this.$node.removeEventListener("scroll",this._scroll,!0),this._parentGrid){var t=this._parentGrid.component._childGrids;Lyte.arrayUtils(t,"removeAt",t.indexOf(this._parentGridIndex))}this._parentComp&&delete this._parentComp._childGrid,document._lyteCurrentGrid==this&&delete document._lyteCurrentGrid,delete this.scopeElement,delete this._style,this.data.lyteGridStack=[],delete this.data.lyteQuerySelector.previousNode,delete this.$node.addGrid,delete this.$node.removeGrid,delete this.$node.reRender,delete this.$node.setProperty},rtlfunc:function(t,e){return this.data.direction?"left"==t?"right":"clientX"==e?window.innerWidth-t:"bccr"==e?window.innerWidth-t.right:e.offsetParent.getBoundingClientRect().right-e.getBoundingClientRect().right:"bccr"==e?t.left:e&&"clientX"!=e?e.offsetLeft:t},windowResize:function(){clearTimeout(window._gridResize),window._gridResize=setTimeout(function(){if(this.$node.offsetParent){var t=this.data.ltPropMinUnitX,e=this.scopeElement.getBoundingClientRect().width-this.data.gridLength*this.data.ltPropMarginLeft,i=this._initialXRatio*e;this.setData("ltPropUnitXCopy",Math.max(i,t)),this.MarginLeftAndXObs.call(this,!0),this.observerFunc.call(this),delete window._gridResize,this.getMethods("onWindowResize")&&$L.fastdom.measure(function(){$L.fastdom.mutate(function(){this.executeMethod("onWindowResize",event,this.$node)}.bind(this))}.bind(this))}}.bind(this),250)},MarginLeft:function(){this.MarginLeftAndXObs.apply(this,arguments)}.observes("ltPropMarginLeft","ltPropUnitX"),MarginLeftAndXObs:function(t){t.constructor==Object&&(this.setData("ltPropUnitXCopy",this.data.ltPropUnitX),this.setData("ltPropMarginLeftCopy",this.data.ltPropMarginLeft));var e=this.getData("ltPropUnitXCopy"),i=this.getData("ltPropMarginLeftCopy");this.setData("gridLength",Math.round((this.scopeElement.getBoundingClientRect().width-i)/(e+i)))},squareGridObs:function(){arguments[0].newValue?(this._originalY=this.getData("ltPropUnitY"),this.setData("ltPropUnitY",this.data.ltPropUnitX)):this._originalY?(this.setData("ltPropUnitY",this._originalY),delete this._originalY):this.setData("ltPropUnitY",50)}.observes("ltPropSquareGrid"),obsfunc:function(){this.getData("ltPropSquareGrid")&&("ltPropUnitX"==arguments[0].item?this.setData("ltPropUnitY",arguments[0].newValue):"ltPropUnitY"==arguments[0].item&&this.setData("ltPropUnitX",arguments[0].newValue)),this._prevObs||this.observerFunc.apply(this,arguments)}.observes("ltPropUnitX","ltPropUnitY","ltPropMarginLeft","ltPropMarginTop"),observerFunc:function(t){var e=this._style;e&&(this.$node.removeChild(e),delete this._style,this.initialValSet.call(this,null,!t))},freezeobs:function(){this.freeezeModeObs.apply(this,arguments)}.observes("ltPropFreezeMode"),freeezeModeObs:function(t){t.constructor!=Object&&t.constructor!=Boolean||(0==t.oldValue||1==t?this.$node.classList.add("gridFreezeMode"):1!=t.oldValue&&0!=t||this.$node.classList.remove("gridFreezeMode"))},columnMode:function(t){if(0==t.newValue){for(var e=this.getData("ltPropHandler"),i=this.getData("iniData"),l=this.scopeElement.querySelectorAll(e),a=0;a<l.length;a++)for(var r in i[a])i[a][r]&&l[a].setAttribute("lyte-grid-"+r,i[a][r]);this.data.ltPropUnitX==(this._originalX||this.getData("ltPropUnitXCopy"))?this.initialValSet(!0):this.setData("ltPropUnitX",this._originalX||this.getData("ltPropUnitXCopy"))}else this._originalX=this.getData("ltPropUnitXCopy"),"ltPropForcedReposition"!=t.item&&(this.columnModeLengthFind(),this.setData("gridLength",this.gridLength(null,this.getData("ltPropUnitXCopy")))),this.initialValSet.call(this)}.observes("ltPropColumn","ltPropColumnMode","ltPropForcedReposition"),bestFitObs:function(t){var e=this._bestfit;e&&(t.newValue&&e.classList.add(t.newValue),t.oldValue&&e.classList.remove(t.oldValue))}.observes("ltPropBestfitClass"),bfObs:function(){var t=this.getData("ltPropBestfit"),e=this.getData("ltPropBestfitType");if(t&&"grid"==e){var i=this.getData("ltPropGridSpaceColor"),l=this.getData("ltPropMarginLeftCopy"),a=this.getData("ltPropMarginTop"),r=this.getData("ltPropUnitXCopy"),h=this.getData("ltPropUnitY");this.scopeElement.style.backgroundImage="linear-gradient(to right,"+i+" "+l+"px,transparent 0px),linear-gradient(to bottom,"+i+" "+a+"px,transparent 0px)",this.scopeElement.style.backgroundSize=r+l+"px "+(h+a)+"px",this._bestfit&&("grid"==arguments[0].newValue&&this._bestfit.classList.add("lyteGrid"),this._bestfit.style.transform="translate(-"+l+"px,-"+a+"px)")}else t&&"default"!=e||(this.scopeElement.style.removeProperty("background-image"),this.scopeElement.style.removeProperty("background-size"),this._bestfit&&(this._bestfit.style.removeProperty("background-image"),this._bestfit.style.removeProperty("background-size"),this._bestfit.style.removeProperty("transform"),"default"==arguments[0].newValue&&this._bestfit.classList.remove("lyteGrid")))}.observes("ltPropBestfit","ltPropBestfitType"),lengthObs:function(){this.setData("gridLength",0),this.$node.reRender()}.observes("ltPropGridLength"),gridColorObs:function(t){"grid"==this.getData("ltPropBestfitType")&&this.getData("ltPropBestfit")&&(this.scopeElement.style.backgroundImage="linear-gradient(to right,"+t.newValue+" "+this.getData("ltPropMarginLeftCopy")+"px,transparent 0px),linear-gradient(to bottom,"+t.newValue+" "+this.getData("ltPropMarginTop")+"px,transparent 0px)")}.observes("ltPropGridSpaceColor"),dataSetting:function(t,e,i,l,a){var r={x:void 0,y:void 0,length:1,height:1,nodeName:"",preX:[],preY:[],preLength:[],preHeight:[],component:void 0};if(i){var h=parseInt(a/l);r.x=void 0,r.y=void 0,r.length=h,r.height=parseInt(this.getData("ltPropDefaultHeight")),this._dopeHgt=r.height}else r=this.initialPosFind.call(this,t);return r.nodeName=t,r.nodeName.dataSet={},r.oldX=[],r.oldY=[],r.oldLength=[],r.oldHeight=[],t.elemNum=e,r.minLength=t.getAttribute("lyte-grid-min-length")?this.returnWid(t.getAttribute("lyte-grid-min-length"),!0):this.returnWid(this.getData("ltPropDefaultMinLength"),!0),r.minHeight=t.getAttribute("lyte-grid-min-height")?this.returnWid(t.getAttribute("lyte-grid-min-height")):this.returnWid(this.getData("ltPropDefaultMinHeight")),r.maxLength=t.getAttribute("lyte-grid-max-length")?this.returnWid(t.getAttribute("lyte-grid-max-length"),!0):this.returnWid(this.getData("ltPropDefaultMaxLength"),!0),r.maxHeight=t.getAttribute("lyte-grid-max-height")?this.returnWid(t.getAttribute("lyte-grid-max-height")):this.returnWid(this.getData("ltPropDefaultMaxHeight")),r.component=this,r},append:function(t,e,i,l){$L.fastdom.mutate(function(){var a=document.createElement("div");a.setAttribute("class",e[i.indexOf(l)]+" lyteGridResize"),t.appendChild(a)})},maxPosFind:function(t,e,i,l,a){for(var r=[],h=[],s=[],n=[],o=0;o<t.length;o++){if(!a){var d=this.emptySpaceFind.call(this,{length:l[o].length,height:l[o].height,x:l[o].x,y:l[o].y,nodeName:l[o].nodeName});t[o]._addGrid&&!i||(l[o].x=d[0].x,l[o].y=d[0].y),t[o]._addGrid&&delete t[o]._addGrid}h.push(l[o].length),r.push(l[o].height),s.push(l[o].y+l[o].height),n.push(l[o].x+l[o].length)}a||this.previousPos.call(this,t,!0),e.MaxLength=Math.max.apply(null,h.length?h:[0]),e.MaxHeight=Math.max.apply(null,r.length?r:[0]),e.MaxBottom=Math.max.apply(null,s.length?s:[0]),e.MaxLeft=Math.max.apply(null,n.length?n:[this.getData("gridLength")])},initialValSet:function(t,e){var i=this.getData("lyteQuerySelector"),l=this.getData("lyteGridStack"),a=this.$node.querySelector(this.data.ltPropScope),r=parseFloat(this.getData("ltPropUnitXCopy")),h=parseFloat(this.getData("ltPropUnitY")),s=parseFloat(this.data.ltPropUnitX),n=parseFloat(this.getData("ltPropMarginTop")),o=parseFloat(this.getData("ltPropMarginLeftCopy")),d=parseInt(this.getData("gridLength")),g=this.getData("ltPropColumnMode"),m=this.getData("ltPropColumn"),c=this.bcrrelem?this.bcrrelem:this.scopeElement.getBoundingClientRect(),u=this.getData("ltPropResizeDirection");i.occupied=[],i.currentPos=0,i.verticalMove=!0;var p=a.querySelectorAll(this.data.ltPropHandler);if(a.dataSet={},i.elementCount=[],!e){for(var y=0;y<p.length;y++){if(l[y]=this.dataSetting.call(this,p[y],y,g,m,d),i.elementCount.push(y),1==this.getData("ltPropResize"))if(0==l[y].nodeName.querySelectorAll(".lyteGridResize").length&&"disabled"!=l[y].nodeName.getAttribute("lyte-grid-resize"))for(var f=0;f<u.length;f++){var v=["left","right","bottom","bottomLeft","bottomRight","top","topLeft","topRight"];-1!=v.indexOf(u[f])&&this.append(p[y],["lyteGridStackLeft","lyteGridStackRight","lyteGridStackBottom","lyteGridStackBottomLeft","lyteGridStackBottomRight","lyteGridStackTop","lyteGridStackTopLeft","lyteGridStackTopRight"],v,u[f])}}this.maxPosFind(p,i,g,l)}if(this._initialWindowWidth==window.innerWidth&&(this._initialXRatio=s/(c.width-this.data.gridLength*this.data.ltPropMarginLeft)),$L.fastdom.mutate(function(){if(a.style.height=i.MaxBottom*h+(i.MaxBottom+1)*parseInt(this.getData("ltPropMarginTop"))+"px","grid"==this.getData("ltPropBestfitType")&&this.getData("ltPropBestfit")){var t=this.getData("ltPropGridSpaceColor");this.scopeElement.style.backgroundImage="linear-gradient(to right,"+t+" "+o+"px,transparent 0px),linear-gradient(to bottom,"+t+" "+n+"px,transparent 0px)",this.scopeElement.style.backgroundSize=r+o+"px "+(h+n)+"px"}}.bind(this)),!t){var x,N=this._style;N||((N=document.createElement("style")).type="text/css",N.id="lyteGridStack",this._style=N,$L.fastdom.mutate(function(){this.$node.appendChild(N)}.bind(this)));var P=this.$node.querySelectorAll(this.data.ltPropHandler);if(P&&P.length)for(var L=0;L<P.length;L++)P[L].classList.add("lyteGridstackHandler");var D=c.width;this._initialXRatio=r/(c.width-this.data.gridLength*this.data.ltPropMarginLeft);for(y=1;y<=Math.max(d,i.MaxBottom)+1;y++)y<=d&&(0==this.$node.querySelectorAll("."+this.data.ltPropHandler.replace(/[.|#]/gi,"")+"lytegridx"+(y-1)).length&&(x=this.data.ltPropScope+" "+this.data.ltPropHandler+'[lyte-grid-x = "'+(y-1)+'"]{'+this.rtlfunc("left")+":"+100*((y-1)*r+y*o)/D+"%;}",this.styleFormation.call(this,x,this.data.ltPropHandler.replace(/[.|#]/gi,"")+"lytegridx"+(y-1))),y<=d&&0==this.$node.querySelectorAll("."+this.data.ltPropHandler.replace(/[.|#]/gi,"")+"lytegridlength"+(y-1)).length&&(x=this.data.ltPropScope+" "+this.data.ltPropHandler+'[lyte-grid-length = "'+y+'"]{width:'+100*(y*r+(y-1)*o)/D+"%;}",this.styleFormation.call(this,x,this.data.ltPropHandler.replace(/[.|#]/gi,"")+"lytegridlength"+(y-1)))),y<=i.MaxBottom+1&&(0==this.$node.querySelectorAll("."+this.data.ltPropHandler.replace(/[.|#]/gi,"")+"lytegridy"+(y-1)).length&&(x=this.data.ltPropScope+" "+this.data.ltPropHandler+'[lyte-grid-y = "'+(y-1)+'"]{top:'+((y-1)*h+y*n)+"px;}",this.styleFormation.call(this,x,this.data.ltPropHandler.replace(/[.|#]/gi,"")+"lytegridy"+(y-1))),y<=i.MaxHeight&&0==this.$node.querySelectorAll("."+this.data.ltPropHandler.replace(/[.|#]/gi,"")+"lytegridheight"+(y-1)).length&&(x=this.getData("ltPropScope")+" "+this.data.ltPropHandler+'[lyte-grid-height = "'+y+'"]{height:'+(y*h+(y-1)*n)+"px;}",this.styleFormation.call(this,x,this.data.ltPropHandler.replace(/[.|#]/gi,"")+"lytegridheight"+(y-1))));this.setData("ltPropGridHeight",i.MaxBottom)}this.displayGrid.call(this,null),this.bcrrelem&&delete this.bcrrelem},maxHeight:function(t){for(var e=this.$node.querySelectorAll(this.data.ltPropHandler),i=[],l=[],a=[],r=0;r<e.length;r++)l.push(t[r].length),i.push(t[r].height),a.push(t[r].y+t[r].height);return[Math.max.apply(null,l),Math.max.apply(null,i),Math.max.apply(null,a)]},styleFormation:function(t,e){$L.fastdom.mutate(function(){if(0==this.$node.querySelectorAll("."+e).length){var i=document.createElement("style");i.type="text/css",i.setAttribute("class",e),this._style.appendChild(i),i.append(t)}}.bind(this))},cssConstruct:function(t,e,i){var l,a=this.data.lyteGridStack,r=this.$node.querySelector(this.data.ltPropScope),h=this.data.lyteQuerySelector,s=this.returnWid(t.getAttribute("lyte-grid-height"),null,t),n=(this.returnWid(t.getAttribute("lyte-grid-length"),!0,t),parseInt(t.getAttribute("lyte-grid-x")),parseInt(t.getAttribute("lyte-grid-y"))),o=(this.data.ltPropUnitXCopy,this.data.ltPropUnitY),d=this.data.ltPropMarginTop;this.data.ltPropMarginLeftCopy;if("lyte-grid-height"==e)for(var g=Math.max(s,h.MaxHeight),m=0;m<=g;m++){var c=this.data.ltPropHandler.replace(/[.|#]/gi,"")+"lytegridheight"+(m+1);0==this.$node.querySelectorAll("."+c).length&&(l=this.data.ltPropScope+" "+this.data.ltPropHandler+'[lyte-grid-height = "'+m+'"]{height:'+(m*o+(m-1)*d)+"px;}",this.styleFormation.call(this,l,c))}else if("lyte-grid-y"==e&&n+s>=h.MaxBottom){for(m=h.MaxBottom-s;m<=n+s;m++){c=this.data.ltPropHandler.replace(/[.|#]/gi,"")+"lytegridy"+m;0==this.$node.querySelectorAll("."+c).length&&(l=this.data.ltPropScope+" "+this.data.ltPropHandler+'[lyte-grid-y = "'+m+'"]{top:'+(m*o+(m+1)*d)+"px;}",this.styleFormation.call(this,l,c))}h.previousNode=t}if(-1!=["lyte-grid-height","lyte-grid-y"].indexOf(e)){var u=this.maxHeight(a);if(this.setData("ltPropGridHeight",u[2]),h.MaxBottom>u[2])for(var p=h.MaxBottom;p>u[2];p--)if(this.$node.querySelector("."+this.data.ltPropHandler.replace(/[.|#]/gi,"")+"lytegridy"+p)){var y=this._style;if(y){var f=this.$node.querySelector("."+this.data.ltPropHandler.replace(/[.|#]/gi,"")+"lytegridy"+p);f&&f.parentElement==y&&y.removeChild(f)}}h.MaxBottom=u[2]}r.style.height=h.MaxBottom*o+(h.MaxBottom+1)*d+"px"},setVal:function(t,e,i){t.setAttribute(e,i),"lyte-grid-y"!=e&&"lyte-grid-height"!=e&&"lyte-grid-length"!=e&&"lyte-grid-x"!=e||this.cssConstruct.call(this,t,e),t.dataSet[e]=i},displayGrid:function(t,e){for(var i=this.scopeElement.querySelectorAll(this.data.ltPropHandler),l=this.data.lyteQuerySelector,a=this.data.lyteGridStack,r=0;r<i.length;r++)(r!=t&&!e||e&&r==t)&&(this.setVal(i[r],"lyte-grid-y",a[r].y),this.setVal(i[r],"lyte-grid-x",a[r].x),a[r].length!=a[r].nodeName.getAttribute("lyte-grid-length-old")&&this.setVal(i[r],"lyte-grid-length",a[r].length,!0),a[r].height!=a[r].nodeName.getAttribute("lyte-grid-height-old")&&this.setVal(i[r],"lyte-grid-height",a[r].height));this.scopeElement.dataSet["lt-prop-grid-height"]=l.MaxBottom,this.scopeElement.dataSet["lt-prop-grid-length"]=parseInt(this.data.gridLength),$L.fastdom.mutate(function(){this.positionFind.call(this,i)}.bind(this))},positionFind:function(t){t=t||this.scopeElement.querySelectorAll(this.data.ltPropHandler);for(var e,i=[],l=[],a=[],r=[],h=[],s=[],n=this.getData("lyteGridStack"),o=0;o<t.length;o++)a.push(n[o].x),r.push(n[o].y),h.push(n[o].x+n[o].length),s.push(n[o].y+n[o].height);e=Math.max(Math.max.apply(null,a),Math.max.apply(null,r),Math.max.apply(null,h),Math.max.apply(null,s));for(var d=0;d<=e;d++){a=[],r=[],h=[],s=[];for(var g=0;g<n.length;g++)n[g].x<=d&&d<=n[g].x+n[g].length&&a.push(g),n[g].y<=d&&d<=n[g].y+n[g].height&&r.push(g);i.push(a),l.push(r)}Lyte.arrayUtils(this.data.xElements,"remove",0,this.data.xElements.length),Lyte.arrayUtils(this.data.xElements,"concat",i),Lyte.arrayUtils(this.data.yElements,"remove",0,this.data.yElements.length),Lyte.arrayUtils(this.data.yElements,"concat",l)},multipleRemoval:function(t){t=t||[];for(var e=0;e<t.length;e++)for(var i=e+1;i<t.length;i++)t[e]==t[i]&&(Lyte.arrayUtils(t,"removeAt",i),i--);return t},similarData:function(t,e){var i=[];if(void 0!=t&&void 0!=e){for(var l=0;l<t.length;l++)for(var a=0;a<e.length;a++)if(t[l]==e[a]){i.push(t[l]);break}}else i=t||e;return i},elementCheck:function(t,e,i){var l,a=[],r=this.getData("xElements"),h=1,s=this.getData("lyteGridStack");return s[e.elemNum].length>1?(i?(l=s[e.elemNum].x,h=0):l=s[e.elemNum].x+1,a=this.yElementsFind(l,s[e.elemNum].x+s[e.elemNum].length-h,r)):a=this.similarData.call(this,r[s[e.elemNum].x],r[s[e.elemNum].x+1]),a?this.multipleRemoval.call(this,a):[]},nodeName:function(t){var e=t.target.correspondingElement||t.target;if(e){var i,l=!1,a=this.$node.querySelector(this.data.ltPropScope);if("mousedown"==t.type){for(;e&&e!=a&&e.classList&&"BODY"!=e.tagName&&"HTML"!=e.tagName;){if(e.classList.contains("lyteGridStackLeft")){i="left",l=!0;break}if(e.classList.contains("lyteGridStackRight")){i="right",l=!0;break}if(e.classList.contains("lyteGridStackBottom")){i="bottom",l=!0;break}if(e.classList.contains("lyteGridStackBottomLeft")){i="BottomLeft",l=!0;break}if(e.classList.contains("lyteGridStackBottomRight")){i="BottomRight",l=!0;break}if(e.classList.contains("lyteGridStackTop")){i="top",l=!0;break}if(e.classList.contains("lyteGridStackTopLeft")){i="topLeft",l=!0;break}if(e.classList.contains("lyteGridStackTopRight")){i="topRight",l=!0;break}if("LYTE-GRID-CONTENT"==e.tagName){i="content",l=!0;break}e=e.parentNode}if(e!=a&&l)return[i,e.parentElement,e.parentElement.parentElement]}else if("click"==t.type){for(;e&&e!=a&&e.classList&&"BODY"!=e.tagName&&"HTML"!=e.tagName;){if(e.classList.contains("lyteGridstackHandler")&&e.querySelectorAll(".lyteGridResize").length){l=!0;break}e=e.parentNode}if(l)return e}}return null},valueUpdating:function(t,e,i){var l=this.getData("lyteGridStack");l[t][e]!=l[t].nodeName.dataSet[i]&&(l[t].nodeName.dataSet[i+"-old"]=l[t].nodeName.dataSet[i],l[t].nodeName.dataSet[i]=parseInt(l[t][e]))},bottomElementsCount:function(t,e){var i,l,a,r,h,s;"vertical"==e?(s="y",i="x",l="height",a="length",r="xElements",h="yElements","offsetTop","lyte-grid-height","ltPropMarginTop"):(s="x",i="y",l="length",a="height",r="yElements",h="xElements","offsetLeft","lyte-grid-length","ltPropMarginLeftCopy");var n=this.getData("lyteGridStack"),o=this.getData(r),d=this.getData(h),g=[],m=[],c=[];g=n[t.elemNum][l]>1?this.yElementsFind(n[t.elemNum][s]+1,n[t.elemNum][s]+n[t.elemNum][l]-1,d):this.similarData.call(this,d[n[t.elemNum][s]],d[n[t.elemNum][s]+n[t.elemNum][l]]),m=this.multipleRemoval.call(this,m.concat(o[n[t.elemNum][i]+n[t.elemNum][a]])),c=this.multipleRemoval.call(this,c.concat(o[n[t.elemNum][i]])),g=this.multipleRemoval.call(this,g),m.length&&Lyte.arrayUtils(m,"removeAt",m.indexOf(t.elemNum)),c.length&&Lyte.arrayUtils(c,"removeAt",c.indexOf(t.elemNum)),g.length&&Lyte.arrayUtils(g,"removeAt",g.indexOf(t.elemNum));var u=[];return u[u.length]=this.similarData.call(this,g,m).length,u[u.length]=this.similarData.call(this,g,c).length,u},returnY:function(t,e){var i,l,a;return e?(i="offTop",l=this.getData("ltPropMarginTop"),a=this.getData("ltPropUnitY")):(i="offLeft",l=this.getData("ltPropMarginLeftCopy"),a=this.getData("ltPropUnitXCopy")),parseInt(((t[i]-l)/(a+l)).toFixed(0))},scrollCheckY:function(t,e,i,l,a,r,h,s,n,o){if(!this._scrollCheck||o){var d,g="scrollTop",m="top",c="clientY",u="bottom",p="prevEvY";n&&(g="scrollLeft",m="left",c="clientX",u="right",p="prevEvX","prevEvY","clientY","width","scrollWidth");var y=Math.max(e[m],0)>Math.min(l[m],r[c])&&!(e[u]<l[u])&&(r[c]<t[p]||void 0==t[p]),f=Math.min(e[u],a)<Math.max(l[u],r[c])&&!(e[m]>l[m])&&(r[c]>t[p]||void 0==t[p]),v=(this.$node[g],(this.isSaf.isEdgeLyte||this.isSaf.isIE11Lyte)&&this.data.direction?-1:1);if(x.call(this,e,h,s,!n,-i*v,this.data.direction)&&y)this.$node[g]-=1*i*v,d=!0;else{if(!x.call(this,e,h,s,!n,i*v,this.data.direction)||!f)return window.cancelAnimationFrame(this._reqId),delete this._reqId,delete this._scrollCheck,void(t[p]=r[c]);this.$node[g]+=1*i*v,d=!0}d&&(this._scrollCheck=!0,this._reqId=window.requestAnimationFrame(function(){l=t.getBoundingClientRect(),this.scrollCheckY.call(this,t,e,i,l,a,r,h,this.$node[n?"scrollLeft":"scrollTop"],n,!0)}.bind(this)))}function x(t,e,i,l,a,r){var h=l?"height":"width";return!(a>0&&i+t[h]>=e||a<0&&-i+t[h]>=e)&&(!!(!l&&this.isSaf.firefox&&r&&a<0&&0==i)||!(a<0&&0==i&&!(a<0&&this.isSaf.safari&&r&&0==i)))}},mousemoveFun:function(t,e){if(e.preventDefault(),!this._scrollCheck){var i=this.elementSorting.call(this,this.data.lyteQuerySelector),l=this.getData("lyteGridStack");i.previousPosFind||(i.previousPosFind=!0,this.getMethods("onDragStart")&&this.executeMethod("onDragStart",this.retNode(i.SelectedNodes,l),this.$node));for(var a=0;a<i.SelectedNodes.length;a++){var r,h,s,n,o=!0,d=[],g=[],m=l[i.SelectedNodes[a]].nodeName,c=m.xPos,u=m.yPos,p=t.querySelectorAll(this.data.ltPropHandler).e,y=this.rtlfunc(e.clientX,"clientX"),f=e.clientY,v=this.data.gridLength,x=(this.data.ltPropGridHeight,this.data.xElements),N=this.data.yElements,P=this.data.ltPropUnitXCopy,L=this.data.ltPropUnitY,D=this.data.ltPropMarginTop,b=this.data.ltPropMarginLeftCopy,S=this.data.ltPropPrevent;m.offLeft=this.rtlfunc("offsetLeft",m),m.offTop=m.offsetTop,m.classList.add("lyteGridStackMove");var M=this.$node.getBoundingClientRect(),G=this.$node.scrollWidth,k=this.$node.scrollHeight,C=m.getBoundingClientRect(),E=window.innerWidth,A=this.$node.scrollLeft,F=this.$node.scrollTop,T=window.innerHeight;if(l[r=m.elemNum].length!=parseInt(m.getAttribute("lyte-grid-length"))||l[r].height!=parseInt(m.getAttribute("lyte-grid-height"))||m.offLeft<m.initialLeft&&m.offTop<m.initialTop?o=!0:l[r].x==parseInt(m.getAttribute("lyte-grid-x"))?o=!1:m.offTop>m.initialTop+L&&(o=!1),m.flag){h=y-c;var H=f-u;S.horizontal||(m.style[this.rtlfunc("left")]=h+"px",m.offLeft=h),S.vertical||(m.style.top=H+"px",m.offTop=H);var U=this.returnY(m);U!=l[r].x&&(n=!0),l[r].x=U>0?U:0,l[r].x=l[r].x>v-l[r].length?v-l[r].length:l[r].x,this.scrollCheckY.call(this,m,M,L,C,T,e,k,F),this.scrollCheckY.call(this,m,M,P,C,E,e,G,A,!0)}else{var _=l[r].minLength*P+(l[r].minLength-1)*b,w=l[r].maxLength*P+(l[r].maxLength-1)*b,$=l[r].minHeight*L+(l[r].minHeight-1)*D,R=l[r].maxHeight*L+(l[r].maxHeight-1)*D;if(!S.horizontal&&-1!=["right","BottomRight","topRight"].indexOf(m.value)&&m.xOff+y-this.rtlfunc(C,"bccr")>=P){var I=m.xOff+y-this.rtlfunc(C,"bccr");m.style.width=w>=_?Math.min(Math.max(I,_),w)+"px":Math.max(I,_)+"px",l[r].x=this.returnY(m),m.offLeft+parseInt(m.style.width)>v*P+(v+1)*b?l[r].x=v-l[r].length:l[m.elemNum].length=parseInt(((parseInt(m.style.width)+b)/(b+P)).toFixed(0))}else if(!S.horizontal&&-1!=["left","BottomLeft","topLeft"].indexOf(m.value)&&m.xOff+Math.abs(y-this.rtlfunc(C,"bccr")-C.width)>=P){(X=C.width-(-m.xOff+y-this.rtlfunc(C,"bccr")))>0&&X>=_&&(X<=w||w<0)&&(m.style.width=X+"px",m.style[this.rtlfunc("left")]=-m.xOff+y-this.rtlfunc(C,"bccr")+m.offLeft+"px",m.offLeft=parseInt(m.style[this.rtlfunc("left")]));var B=this.returnY(m);m.offLeft+(m.style.width?parseInt(m.style.width):C.width)>v*P+(v+1)*b?B=v-l[r].length:l[m.elemNum].length+=l[r].x-B,l[r].x=B}if(l[r].x=l[r].x>v-l[r].length?v-l[r].length:l[r].x,!S.vertical&&-1!=["BottomRight","BottomLeft","bottom"].indexOf(m.value)&&m.yOff+f-C.top>=L){var O=m.yOff+f-C.top;m.style.height=R>=$?Math.min(Math.max(O,$),R)+"px":Math.max(O,$)+"px",l[m.elemNum].height=parseInt((((m.style.height?parseInt(m.style.height):C.height)+D)/(D+L)).toFixed(0))}else if(!S.vertical&&-1!=["top","topRight","topLeft"].indexOf(m.value)&&m.yOff+Math.abs(f-C.top-C.height)>=L){var X;(X=C.height-(-m.yOff+f-C.top))>0&&X>=$&&(X<=R||R<0)&&(m.style.height=X+"px",m.style.top=-m.yOff+f-C.top+m.offTop+"px",m.offTop=parseInt(m.style.top));B=this.returnY(m,!0);B=Math.max(B,0),l[m.elemNum].height+=l[r].y-B,l[r].y=B}this._parentGrid&&(m._percentHeight=100*(m.style.height?parseInt(m.style.height):C.height+2*D)/M.height+"%",m._percentLength=100*(m.style.width?parseInt(m.style.width):C.width+2*b)/M.width+"%")}var Y=this.bottomElementsCount.call(this,m,"horizontal"),z=this.bottomElementsCount.call(this,m,"vertical");if(m.initialTop>m.offTop&&!S.vertical?this.verticalMoveBottomToTop.call(this,t,m):m.initialTop<m.offTop&&!S.vertical&&this.verticalMoveTopToBottom.call(this,t,m),S.horizontal||(0!=z[0]&&m.offLeft>m.initialLeft||!m.flag||0!=z[1]&&m.initialLeft>m.offLeft&&l[m.elemNum].height<=parseInt(m.getAttribute("lyte-grid-height"))||l[r].length>m.dataSet["lyte-grid-length-old"]&&l[m.elemNum].height<=parseInt(m.getAttribute("lyte-grid-height")))&&(this.topCheck.call(this,m,t),this.getData("ltPropFloat")||this.topMoveFunc.call(this,m,null,null,null,!0)),!S.vertical&&(o||0==Y[0]&&m.initialTop<m.offTop||0==Y[1]&&m.initialTop>m.offTop||!this.getData("ltPropFloat"))){var q=parseInt(((m.offTop-D)/(L+D)).toFixed(0));-1!=["top","topLeft","topRight"].indexOf(m.value)?l[r].y=q:0==Y[0]&&m.initialTop<m.offTop?l[r].y<=q&&(l[r].y=q):0==Y[1]&&m.initialTop>m.offTop&&l[r].y>=q&&(l[r].y=q),l[r].y=l[r].y>0?l[r].y:0}if(n||l[m.elemNum].x!=parseInt(m.getAttribute("lyte-grid-x"))||l[m.elemNum].length!=parseInt(m.getAttribute("lyte-grid-length"))||l[m.elemNum].height!=parseInt(m.getAttribute("lyte-grid-height"))){this.valueUpdating.call(this,r,"x","lyte-grid-x"),this.valueUpdating.call(this,r,"y","lyte-grid-y"),this.valueUpdating.call(this,r,"length","lyte-grid-length"),this.valueUpdating.call(this,r,"height","lyte-grid-height"),this.positionFind.call(this,p);var W,V=0;l=this.getData("lyteGridStack");for((m.initialLeft>m.offLeft||m.initialLeft<m.offLeft||m.dataSet["lyte-grid-length-old"]>l[m.elemNum].length)&&(d=x[l[m.elemNum].x].concat(x[l[m.elemNum].x+l[m.elemNum].length])),g=this.yElementsFind.call(this,l[m.elemNum].y+l[m.elemNum].height,i.MaxBottom,N),-1!=(d=this.multipleRemoval.call(this,this.similarData.call(this,d,g))).indexOf(m.elemNum)&&Lyte.arrayUtils(d,"removeAt",d.indexOf(m.elemNum)),W=0;W<d.length;W++)if(l[m.elemNum].y+l[m.elemNum].height<=l[d[W]].y+1&&(m.initialLeft>m.offLeft&&l[d[W]].x==l[m.elemNum].x+l[m.elemNum].length||m.initialLeft<m.offLeft&&l[m.elemNum].x==l[d[W]].x+l[d[W]].length||m.dataSet["lyte-grid-length-old"]-l[m.elemNum].length==1)&&(s=this.heightGet.call(this,l[d[W]].nodeName))){!1,V=l[d[W]].y,l[d[W]].y=l[d[W]].y-(this.getData("ltPropFloat")&&l[d[W]].y-s<l[m.elemNum].y?l[d[W]].y-l[m.elemNum].y:s),this.valueUpdating.call(this,d[W],"y","lyte-grid-y"),this.positionFind.call(this,p),this.topMoveFunc.call(this,l[d[W]].nodeName,V,!1,m),this.displayGrid.call(this,m.elemNum);break}(l[m.elemNum].y<parseInt(m.getAttribute("lyte-grid-y"))||m.initialTop-m.offTop>parseInt(D))&&!this.getData("ltPropFloat")&&this.topMoveFunc.call(this,m,parseInt(m.getAttribute("lyte-grid-y")),!1,m),l[m.elemNum].height>m.dataSet["lyte-grid-height-old"]&&!m.flag?(i.verticalMove=!1,m.setAttribute("lyte-grid-height",l[m.elemNum].height),this.verticalCheck.call(this,l[m.elemNum],l[m.elemNum].y+l[m.elemNum].height,l[m.elemNum].y+l[m.elemNum].height,m,!0),this.displayGrid.call(this,m.elemNum)):l[m.elemNum].height<m.dataSet["lyte-grid-height-old"]&&!m.flag&&(i.verticalMove=!1,m.setAttribute("lyte-grid-height",l[m.elemNum].height),this.topMoveFunc.call(this,m,l[m.elemNum].y,!0),this.displayGrid.call(this,m.elemNum)),e.preventDefault(),this.getData("ltPropFloat")||this.topMoveAllGrid.call(this,m,l)}s=this.getData("ltPropFloat")?0:this.heightGet.call(this,m),this.getMethods("onDrag")&&this.executeMethod("onDrag",m,e,this.$node)}var Q=this._bestfit;if(Q&&m&&this.getData("ltPropBestfit")&&1==i.SelectedNodes.length){var K=this.getData("ltPropBestfitType");if(Q.style[this.rtlfunc("left")]=l[m.elemNum].x*P+(l[m.elemNum].x+1)*b+"px",Q.style.top=(l[m.elemNum].y-s)*L+(l[m.elemNum].y+1-s)*D+"px",Q.style.width=l[m.elemNum].length*P+(l[m.elemNum].length-1)*b+("grid"==K?b:0)+"px",Q.style.height=l[m.elemNum].height*L+(l[m.elemNum].height-1)*D+("grid"==K?D:0)+"px",Q.style.display="block","grid"==K){var j=this.getData("ltPropGridSpaceColor");Q.style.backgroundImage="linear-gradient(to right,"+j+" "+b+"px,transparent 0px),linear-gradient(to bottom,"+j+" "+D+"px,transparent 0px)",Q.style.backgroundSize=b+P+"px "+(L+D)+"px",Q.style.transform="translate(-"+(this.data.direction?0:b)+"px,-"+D+"px)"}}}},topMoveAllGrid:function(t,e){for(var i=this.getData("yElements"),l=t.constructor==Number?t:e[t.elemNum].y+e[2*t.elemNum.height],a=this.similarData(this.elementSorting(this.yElementsFind(t.constructor==Number?t:e[t.elemNum].y+e[t.elemNum].height,Math.min(this.getData("lyteQuerySelector").MaxBottom,isNaN(l)?this.getData("lyteQuerySelector").MaxBottom:l),i))),r=0;r<a.length;r++)if(a[r]!=t.elemNum){var h=this.heightGet.call(this,e[a[r]].nodeName);h&&(e[a[r]].y=e[a[r]].y-h,this.valueUpdating.call(this,a[r],"y","lyte-grid-y"),this.topMoveFunc.call(this,e[a[r]].nodeName,e[a[r]].y),this.displayGrid.call(this,a[r],!0))}},verticalMoveBottomToTop:function(t,e){$L.fastdom.measure(function(){var i,l,a=[],r=0,h=[],s=this.getData("ltPropFloat"),n=this.getData("ltPropMarginTop"),o=this.getData("lyteGridStack");h=this.elementCheck.call(this,t,e),i=o[e.elemNum].y,l=this.getData("yElements")[i];var d=e.offTop;for(l&&(h=this.similarData.call(this,h,l)),-1!=h.indexOf(e.elemNum)&&Lyte.arrayUtils(h,"removeAt",h.indexOf(e.elemNum)),m=0;m<h.length;m++){var g=o[h[m]].nodeName.offsetTop;d<g+o[h[m]].nodeName.offsetHeight-.5*n&&d>g+n&&o[e.elemNum].y==o[h[m]].y+o[h[m]].height&&e.initialTop>d&&(a[a.length]=h[m])}if(a.length){a=this.elementSorting.call(this,a||[]),this._occupied=a.slice();for(var m=0;m<a.length;m++){r=this.heightGet.call(this,e,o[a[m]].nodeName),s&&(r=o[a[m]].height>r?r:o[a[m]].height);var c=o[a[m]].y+o[a[m]].height;-1==["top","topLeft","topRight"].indexOf(e.value)&&(o[e.elemNum].y=c-r,this.valueUpdating.call(this,e.elemNum,"y","lyte-grid-y"));var u=o[e.elemNum].y+o[e.elemNum].height<o[a[m]].y-this.heightGet.call(this,o[a[m]].nodeName)?o[a[m]].y-this.heightGet.call(this,o[a[m]].nodeName):o[e.elemNum].y+o[e.elemNum].height;this.verticalCheck.call(this,o[a[m]],c,u+o[a[m]].height,e,!0),o[a[m]].y=u,this.valueUpdating.call(this,a[m],"y","lyte-grid-y"),(!s||m==a.length-1&&0!=m)&&this.topMoveFunc.call(this,e,o[e.elemNum].y+r,!1),s||this.topMoveFunc.call(this,o[a[m]].nodeName,o[a[m]].y,!0)}delete this._occupied,this.displayGrid.call(this)}}.bind(this))},verticalMoveTopToBottom:function(t,e){$L.fastdom.measure(function(){var i,l,a,r=[],h=[],s=0,n=this.getData("lyteGridStack"),o=this.getData("ltPropUnitY");for(h=this.elementCheck.call(this,t,e),l=n[e.elemNum].y,(a=this.getData("yElements")[l+n[e.elemNum].height])&&(h=this.similarData.call(this,h,a)),-1!=h.indexOf(e.elemNum)&&Lyte.arrayUtils(h,"removeAt",h.indexOf(e.elemNum)),i=0;i<h.length;i++){var d=n[h[i]].nodeName.offsetTop,g=n[h[i]].nodeName.offsetHeight,m=this.rtlfunc("offsetLeft",n[h[i]].nodeName),c=n[h[i]].nodeName.offsetWidth,u=e.offsetHeight;e.offTop>d+(this.getData("ltPropHitBottom")?g-parseInt(this.getData("ltPropMarginTop")):parseInt(this.getData("ltPropMarginTop"))-u)&&e.initialTop<=e.offTop&&m+c>e.initialLeft&&e.initialLeft+e.clientWidth>m&&(e.initialTop+u<d||e.initialTop>d+g)&&(r[r.length]=h[i])}if(r.length){var p=[];for(i=0;i<r.length;i++)p.push(n[r[i]].height+n[r[i]].y);for(var y=p.reduce(function(t,e){return Math.max(t,e)}),f=0;f<r.length;f++)this.getData("ltPropFloat")?(n[e.elemNum].y=parseInt(((e.offsetTop-o)/(o+parseInt(this.getData("ltPropMarginTop")))).toFixed(0)),this.verticalCheck.call(this,n[e.elemNum],parseInt(e.getAttribute("lyte-grid-y"))+n[e.elemNum].height,n[e.elemNum].y+n[e.elemNum].height,e,!0)):((s=this.heightGet.call(this,n[r[f]].nodeName,e))&&(n[r[f]].y-=s,this.valueUpdating.call(this,r[f],"y","lyte-grid-y"),y=0==f?n[r[f]].height+n[r[f]].y:n[r[f]].height+n[r[f]].y>n[r[f-1]].height+n[r[f-1]].y?n[r[f]].height+n[r[f]].y:n[r[f-1]].height+n[r[f-1]].y),n[e.elemNum].y=y,i!=r.length-1&&0==i||this.topMoveFunc.call(this,n[r[f]].nodeName));this.valueUpdating.call(this,e.elemNum,"y","lyte-grid-y"),this.verticalCheck.call(this,n[e.elemNum],parseInt(e.getAttribute("lyte-grid-y"))+n[e.elemNum].height,n[e.elemNum].y+n[e.elemNum].height,n[e.elemNum].nodeName,!0),this.displayGrid.call(this)}}.bind(this))},heightGet:function(t,e,i){if(t.elemNum>=0){var l,a,r=[],h=0,s=[],n=[],o=this.getData("lyteGridStack");e||(e=t);var d=this.getData("xElements"),g=this.getData("yElements");s=o[t.elemNum].length>1?this.yElementsFind(o[t.elemNum].x+1,o[t.elemNum].length+o[t.elemNum].x-1,d):this.similarData.call(this,d[o[t.elemNum].x],d[o[t.elemNum].x]);for(var m=o[t.elemNum].y+o[t.elemNum].height-1;m>=0;m--)n=this.yElementsFind(0,o[t.elemNum].y+o[t.elemNum].height-1,g);for(-1!=(s=this.multipleRemoval(this.elementSorting.call(this,this.similarData.call(this,s,n)))).indexOf(t.elemNum)&&Lyte.arrayUtils(s,"removeAt",s.indexOf(t.elemNum)),l=0;l<s.length;l++)(s[l]!=e.elemNum||i)&&o[t.elemNum].y>=o[s[l]].y&&(o[s[l]].x>o[t.elemNum].x&&o[s[l]].x<o[t.elemNum].x+o[t.elemNum].length||o[s[l]].x+o[s[l]].length>o[t.elemNum].x&&o[s[l]].x+o[s[l]].length<o[t.elemNum].x+o[t.elemNum].length||o[s[l]].x>o[t.elemNum].x&&o[s[l]].x+o[s[l]].length<o[t.elemNum].x+o[t.elemNum].length||o[s[l]].x<o[t.elemNum].x&&o[s[l]].x+o[s[l]].length>o[t.elemNum].x+o[t.elemNum].length||o[s[l]].x==o[t.elemNum].x||o[s[l]].x+o[s[l]].length==o[t.elemNum].length+o[t.elemNum].x)&&(r[r.length]=s[l]);for(a=0;a<r.length;a++)0==a?h+=-o[r[0]].y-o[r[0]].height+o[t.elemNum].y:-o[r[a]].y-o[r[a]].height+o[t.elemNum].y<h&&(h=-(o[r[a]].y+o[r[a]].height-o[t.elemNum].y));return 0==r.length&&(h=o[t.elemNum].y),h<0&&(h=0),h}},topMoveFunc:function(t,e,i,l,a){var r,h,s=[],n=this.getData("lyteQuerySelector"),o=n.occupied,d=n.element,g=this.getData("lyteGridStack");for(o.push(t.elemNum),l=l||t,-1!=(s=this.elementSorting.call(this,this.elementCheck.call(this,d,t,a))).indexOf(t.elemNum)&&Lyte.arrayUtils(s,"removeAt",s.indexOf(t.elemNum)),o=o.concat(s),r=0;r<s.length;r++)g[s[r]].nodeName.classList.contains("gridSelected")||(g[t.elemNum].x>=g[s[r]].x&&g[t.elemNum].x+g[t.elemNum].length<=g[s[r]].x||g[t.elemNum].x+g[t.elemNum].length>=g[s[r]].x&&g[t.elemNum].x+g[t.elemNum].length<=g[s[r]].x+g[s[r]].length||g[t.elemNum].x>g[s[r]].x||g[t.elemNum].x+g[t.elemNum].length>g[s[r]].x+g[s[r]].length)&&(g[t.elemNum].y+g[t.elemNum].height<=g[s[r]].y+g[s[r]].height||i)&&(h=this.heightGet.call(this,g[s[r]].nodeName,null,!i),g[s[r]].y=g[s[r]].y-h,this.valueUpdating.call(this,s[r],"y","lyte-grid-y"),this.positionFind.call(this),h&&(this.topMoveFunc.call(this,g[s[r]].nodeName,g[s[r]].y+h,i,l),i||this.displayGrid.call(this,l.elemNum)))},elementSorting:function(t,e){var i;i=e?"x":"y";for(var l=this.getData("lyteGridStack"),a=0;a<t.length;a++)for(var r=a+1;r<t.length;r++)if(l[t[a]][i]>l[t[r]][i]){var h=t[a];t[a]=t[r],t[r]=h}return t},topCheck:function(t,e,i,l,a,r){var h,s,n,o=!1,d=[],g=[],m=[],c=0,u=this.getData("lyteGridStack"),p=this.getData("xElements"),y=this.getData("yElements");for(s=u[t.elemNum].y,g=u[t.elemNum].length>1?this.elementSorting(this.multipleRemoval(this.yElementsFind.call(this,u[t.elemNum].x+1,u[t.elemNum].x+u[t.elemNum].length-1,p))):this.similarData.call(this,p[u[t.elemNum].x],p[u[t.elemNum].x+1]),(m=u[t.elemNum].height>1?this.yElementsFind(s+1,u[t.elemNum].y+u[t.elemNum].height-1,y):this.similarData.call(this,y[u[t.elemNum].y],y[u[t.elemNum].y+1]))&&(g=this.similarData.call(this,g,this.multipleRemoval.call(this,m))),-1!=(g=this.elementSorting.call(this,this.multipleRemoval.call(this,g))).indexOf(t.elemNum)&&Lyte.arrayUtils(g,"removeAt",g.indexOf(t.elemNum)),h=g.length-1;h>-1&&(i?u[t.elemNum].x==t.getAttribute("lyte-grid-x")&&u[t.elemNum].length==t.getAttribute("lyte-grid-length")||(o=!0):((u[t.elemNum].x+u[t.elemNum].length>u[g[h]].x&&u[t.elemNum].x<u[g[h]].x||u[t.elemNum].x<u[g[h]].x+u[g[h]].length&&u[g[h]].x+u[g[h]].length<=u[t.elemNum].x+u[t.elemNum].length)&&s+u[t.elemNum].height>u[g[h]].y&&s<u[g[h]].y||s<u[g[h]].y+u[g[h]].height&&u[g[h]].y+u[g[h]].height<s+u[t.elemNum].height||s>=u[g[h]].y&&u[g[h]].y+u[g[h]].height>=s+u[t.elemNum].height||u[g[h]].y+u[g[h]].height<s+u[t.elemNum].height&&s<u[g[h]].y)&&(o=!0),!o||u[g[h]].nodeName.classList.contains("gridSelected")||!(u[t.elemNum].x<=u[g[h]].x+u[g[h]].length-1||u[g[h]].x+1>=u[t.elemNum].x+u[t.elemNum].length)||(d[d.length]=g[h],c+=u[g[h]].height,"horizontal"==this.getData("ltPropDirection")||l));h--)o=!1;if(d.length){i||this.valueUpdating.call(this,t.elemNum,"x","lyte-grid-x"),d=this.elementSorting.call(this,d,!0);for(var f=0;f<d.length;f++){var v=this.heightGet.call(this,u[d[f]].nodeName),x=u[t.elemNum].height+u[t.elemNum].y-v;if(n=x,"horizontal"==this.getData("ltPropDirection")||a){if(f>0&&(parseInt(u[d[f]].nodeName.getAttribute("lyte-grid-x"))+parseInt(u[d[f]].nodeName.getAttribute("lyte-grid-length"))==this.getData("gridLength")||0==parseInt(u[d[f]].nodeName.getAttribute("lyte-grid-x"))))break;this.rtlfunc("offsetLeft",t)>this.rtlfunc("offsetLeft",u[d[f]].nodeName)&&!a?this.horiMovement.call(this,t,d[f],"left",c,1==d.length||d.length>2&&1!=f,r):(this.rtlfunc("offsetLeft",t)<this.rtlfunc("offsetLeft",u[d[f]].nodeName)||a)&&this.horiMovement.call(this,t,d[f],"right",c,1==d.length||d.length>2&&1!=f,r)}else this.verticalCheck.call(this,u[d[f]],u[d[f]].y+u[d[f]].height,x+v+u[d[f]].height,t,u[t.elemNum].height<u[d[f]].height),u[d[f]].y=(n>u[t.elemNum].height+u[t.elemNum].y?n:u[t.elemNum].height+u[t.elemNum].y)-(this.getData("ltPropFloat")?0:this.heightGet.call(this,u[t.elemNum].nodeName)),this.valueUpdating.call(this,d[f],"y","lyte-grid-y");this.data.ltPropFloat||this.topMoveFunc.call(this,u[d[f]].nodeName,0==f||0!=u[d[f]].x&&u[d[f]].x+u[d[f]].length!=parseInt(this.data.gridLength)),this.displayGrid.call(this,t.elemNum)}}},horiMovement:function(t,e,i,l,a,r){var h=this.getData("lyteGridStack"),s=this.getData("lyteQuerySelector");if(h[e].x="left"==i?h[e].x-(r||1):h[e].x+(r||1),h[e].x<0||h[e].x+h[e].length>parseInt(this.getData("gridLength"))){h[e].x<0?h[e].x=0:h[e].x=parseInt(this.getData("gridLength"))-h[e].length,this.valueUpdating.call(this,e,"x","lyte-grid-x");var n=h[e].y+h[e].height;h[e].y=h[t.elemNum].y+h[t.elemNum].height;var o=this.getData("ltPropHandler");this.positionFind.call(this,this.scopeElement.querySelectorAll(o)),this.verticalCheck.call(this,h[e],n,h[t.elemNum].y+h[t.elemNum].height+h[e].height,t),this.valueUpdating.call(this,e,"y","lyte-grid-y"),this.displayGrid.call(this)}else{this.valueUpdating.call(this,e,"x","lyte-grid-x"),h[e].nodeName.initialLeft=[],h[e].nodeName.initialTop=[];for(var d=0;d<3;d++)h[e].nodeName.initialLeft[d]=this.rtlfunc("offsetLeft",h[e].nodeName),h[e].nodeName.initialTop[d]=h[e].nodeName.offsetTop;if(this.topCheck.call(this,h[e].nodeName,s.element,!0,null,!!r,r),a){var g=this.heightGet.call(this,h[e].nodeName);this.getData("ltPropFloat")||(h[e].y-=g,g&&this.topMoveFunc.call(this,h[e].nodeName))}this.displayGrid.call(this)}},verticalCheck:function(t,e,i,l,a,r){var h,s=[],n=[],o=!1,d=!1,g=[],m=[],c=[],u=this.getData("lyteGridStack");l=l||t.nodeName;var p=this.getData("xElements"),y=this.getData("yElements"),f=this.scopeElement;n="left"==r?n.concat(p[t.x]||[]):"right"==r?n.concat(p[t.x+t.length]||[]):t!=u[l.elemNum]?t.length>1?this.yElementsFind(t.x+1,t.x+t.length-1,p):this.similarData.call(this,p[t.x]||[],p[t.x+1]||[]):this.elementCheck.call(this,f,t.nodeName),n=this.multipleRemoval.call(this,n);for(var v=i-t.height;v<=i;v++)g=g.concat(y[v]||[]);for(g&&(n=this.similarData.call(this,n,this.multipleRemoval.call(this,g))),-1!=(n=this.elementSorting.call(this,n)).indexOf(t.nodeName.elemNum)&&Lyte.arrayUtils(n,"removeAt",n.indexOf(t.nodeName.elemNum)),-1!=n.indexOf(l.elemNum)&&Lyte.arrayUtils(n,"removeAt",n.indexOf(l.elemNum)),r&&(this.similarData.call(this,n,y[t.y+t.height].concat(y[t.y])).length||(n=[])),D=0;D<n.length;D++)n[D]!=t.nodeName.elemNum&&n[D]!=l.elemNum&&(a&&t.y==u[n[D]].y&&(d=!0),t.y<u[n[D]].y+u[n[D]].height||d?(s[s.length]=n[D],o=!0):a&&u[n[D]].y+u[n[D]].height>=t.y+t.height&&(s[s.length]=n[D],o=!0)),o&&(o=!1,m.push(u[s[s.length-1]].height+u[s[s.length-1]].y),s.length>1&&c.push(u[s[s.length-1]].y-(u[s[0]].y+u[s[0]].height)));if(s.length){s=this.elementSorting.call(this,s),h=i;var x=[],N=[];i=Math.max.apply(null,m)-u[s[0]].y+h;for(var P=0;P<s.length;P++){var L=this.heightGet.call(this,u[s[P]].nodeName);if(0==P){if(h<=u[s[P]].y&&a)break;u[s[P]].y-h<1&&(u[s[P]].y=h,L=this.heightGet.call(this,u[s[P]].nodeName),u[s[P]].y-L>=h&&(u[s[P]].y-=L))}else u[s[P]].y=u[s[0]].y+u[s[0]].height+c[P-1],L=this.heightGet.call(this,u[s[P]].nodeName),u[s[P]].y-L>=h&&(u[s[P]].y-=L);this.valueUpdating.call(this,s[P],"y","lyte-grid-y")}x=this.yElementsFind.call(this,Math.min(t.x,u[l.elemNum].x),Math.max(t.x+t.length,u[l.elemNum].x+u[l.elemNum].length),p);for(var D=(x=this.elementSorting.call(this,this.multipleRemoval.call(this,this.similarData.call(this,x,s)))).length-1;D>=0;D--){N=[];var b=[];for(P=u[x[D]].x+1;P<u[x[D]].x+u[x[D]].length;P++)N=N.concat(p[P]);1==u[x[D]].length&&(N=this.similarData.call(this,p[u[x[D]].x],p[u[x[D]].x+1])),b=a?this.elementSorting.call(this,this.multipleRemoval.call(this,this.similarData.call(this,N,this.yElementsFind.call(this,parseInt(u[x[D]].nodeName.getAttribute("lyte-grid-y"))+1,parseInt(u[x[D]].nodeName.getAttribute("lyte-grid-y"))+u[x[D]].height,y)))):this.elementSorting.call(this,this.multipleRemoval.call(this,this.similarData.call(this,N,this.yElementsFind.call(this,parseInt(u[x[D]].nodeName.getAttribute("lyte-grid-y"))+1,parseInt(u[x[D]].nodeName.getAttribute("lyte-grid-y"))+u[x[D]].height,y)).concat(this.similarData.call(this,N,this.yElementsFind.call(this,parseInt(u[x[D]].y)+1,parseInt(u[x[D]].y)+u[x[D]].height,y)))));for(var S=0;S<b.length;S++)if(-1==s.indexOf(b[S])&&t.nodeName.elemNum!=b[S]&&l.elemNum!=b[S]){if(this._occupied&&-1!=this._occupied.indexOf(b[S]))continue;this.additionalCheck.call(this,b[S],u[x[D]].y+u[x[D]].height,s)}}}},yElementsFind:function(t,e,i){for(var l=[],a=t;a<=e;a++)l=l.concat(i[a]||[]);return l},additionalCheck:function(t,e,i){var l=this.getData("xElements"),a=this.getData("yElements"),r=this.getData("lyteGridStack"),h=[],s=[],n=e,o=t;h=h.concat(this.yElementsFind.call(this,parseInt(r[t].nodeName.getAttribute("lyte-grid-y"))+r[t].height,r[t].y+r[t].height,a)),s=r[t].length>1?(s=s.concat(l[r[t].x+1])).concat(l[r[t].x+r[t].length-1]):s.concat(this.similarData.call(this,l[r[t].x],l[r[t].x+1])),-1!=(h=this.similarData.call(this,h,s)).indexOf(t)&&Lyte.arrayUtils(h,"removeAt",h.indexOf(t));for(var d=0;d<h.length;d++)-1==i.indexOf(h[d])&&(i.push(h[d]),this.additionalCheck.call(this,h[d],e+r[t].height,i));if(r[o].y>n){var g=this.heightGet.call(this,r[o].nodeName);r[o].y-g<=n?r[o].y=n:r[o].y-=g}else r[o].y=n;i.push(o),this.valueUpdating.call(this,o,"y","lyte-grid-y")},previousPos:function(t,e){if(t&&t.length){for(var i=this.getData("lyteGridStack"),l=this.getData("lyteQuerySelector"),a=0;a<t.length;a++)l.currentPos<i[a].oldX.length&&(Lyte.arrayUtils(i[a].oldX,"remove",l.currentPos+1,i[a].oldX.length),Lyte.arrayUtils(i[a].oldY,"remove",l.currentPos+1,i[a].oldY.length),Lyte.arrayUtils(i[a].oldLength,"remove",l.currentPos+1,i[a].oldLength.length),Lyte.arrayUtils(i[a].oldHeight,"remove",l.currentPos+1,i[a].oldHeight.length)),i[a].oldX[i[a].oldX.length]=e?i[a].x:i[a].nodeName.getAttribute("lyte-grid-x"),i[a].oldY[i[a].oldY.length]=e?i[a].y:i[a].nodeName.getAttribute("lyte-grid-y"),i[a].oldLength[i[a].oldLength.length]=e?i[a].length:i[a].nodeName.getAttribute("lyte-grid-length"),i[a].oldHeight[i[a].oldHeight.length]=e?i[a].height:i[a].nodeName.getAttribute("lyte-grid-height");l.currentPos=i[0].oldX.length-1}},mousedown:function(t){if(!this.getData("ltPropFreezeMode")){var e=this.data.lyteQuerySelector,i=this,l=this.data.lyteGridStack,a=this.nodeName.call(this,t);if(a){this.mvefunc=this.mMove.bind(this),this.upfunc=this.mouseup.bind(this),t.stopPropagation();var r=a[0],h=a[1],s=this.$node.querySelector(this.data.ltPropScope);if(t.shiftKey){if(!e.allowMovement){this.getMethods("onBeforeSelect")&&(n=this.executeMethod("onBeforeSelect",a[1],t,this.$node)),0!=n&&((h=a[1]).initialLeft=[],h.initialTop=[],h.classList.contains("gridSelected")?h.classList.remove("gridSelected"):h.classList.add("gridSelected"))}}else if(e.BottomToTopFlag=!0,e.allowMovement=!0,this.mvefunc=this.mMove.bind(this),0==s.querySelectorAll(this.data.ltPropHandler+".gridSelected").length){var n;if(this.getMethods("onBeforeSelect")&&(n=this.executeMethod("onBeforeSelect",a[1],t,this.$node)),h&&0!=n){if(e.SelectedNodes=[],$L.fastdom.mutate(function(){h.classList.add("gridSelected")}),$L.fastdom.measure(function(){if(e.SelectedNodes.push(h.elemNum),e.element=s,h.initialLeft=this.rtlfunc("offsetLeft",h),h.initialTop=h.offsetTop,h.initialy=l[h.elemNum].y,h.initialx=l[h.elemNum].x,h.xPos=this.rtlfunc(t.clientX,"clientX")-this.rtlfunc("offsetLeft",h),h.yPos=t.clientY-h.offsetTop,"content"==r)h.flag=!0;else{h.value=r;var i=h.getBoundingClientRect();-1!=["BottomRight","right","topRight"].indexOf(r)?h.xOff=this.rtlfunc(i,"bccr")+i.width-this.rtlfunc(t.clientX,"clientX"):h.xOff=-this.rtlfunc(i,"bccr")+this.rtlfunc(t.clientX,"clientX"),-1!=["BottomRight","bottom","BottomLeft"].indexOf(r)?h.yOff=i.top+i.height-t.clientY:h.yOff=-i.top+t.clientY,h.flag=!1}}.bind(this)),this.getData("ltPropBestfit")&&!this._bestfit){var o=this.getData("ltPropBestfitClass"),d=document.createElement("div");d.classList.add("lyteBestFit"),"grid"==this.getData("ltPropBestfitType")&&d.classList.add("lyteGrid"),o&&d.classList.add(o),d.style.display="none",this._bestfit=d,$L.fastdom.mutate(function(){s.appendChild(d)})}document.body.addEventListener("mousemove",this.mvefunc,!0),this.getMethods("onSelect")&&this.executeMethod("onSelect",h,t,this.$node)}}else{e.SelectedNodes=[];h=this.$node.querySelectorAll(this.data.ltPropHandler+".gridSelected");$L.fastdom.measure(function(){for(var l=0;l<h.length;l++)e.SelectedNodes.push(s.querySelectorAll(i.getData("ltPropHandler")+".gridSelected")[l].elemNum),h[l].left=h[l].offsetLeft,h[l].top=h[l].offsetTop,h[l].flag=!0,h[l].initialLeft=h[l].offsetLeft,h[l].initialTop=h[l].offsetTop,h[l].xPos=this.rtlfunc(t.clientX,"clientX")-h[l].offsetLeft,h[l].yPos=t.clientY-h[l].offsetTop;e.SelectedNodes=this.elementSorting.call(this,e.SelectedNodes)}.bind(this)),document.body.addEventListener("mousemove",this.mvefunc,!0),this.getMethods("onSelect")&&this.executeMethod("onSelect",h,t,this.$node)}e.previousPosFind=!1}t.preventDefault()}},mMove:function(t){this.mousemoveFun.call(this,this.scopeElement,t),t.stopPropagation(),t.preventDefault()},mouseup:function(t){var e,i=this.getData("lyteQuerySelector"),l=this.getData("lyteGridStack"),a=(this.nodeName.call(this,t),this.$node.querySelector(this.data.ltPropScope));this.elementSorting.call(this,i.elementCount);if(!t.shiftKey||i.allowMovement){var r,h,s=this._bestfit;if(i.verticalMove=!0,i.allowMovement=!1,i.SelectedNodes.length){for(h=this.$node.querySelectorAll(this.data.ltPropHandler+".gridSelected"),this.getMethods("onBeforeDrop")&&(r=this.executeMethod("onBeforeDrop",h,event,this.$node)),e=i.SelectedNodes.length-1;e>=0;e--){var n=l[i.SelectedNodes[e]].nodeName;if(n.classList.contains("gridSelected")){if(!this.getData("ltPropFloat")&&0!=r){var o=this.heightGet.call(this,n);l[n.elemNum].y-=o,this.topCheck.call(this,n,this.scopeElement),this.topMoveFunc.call(this,n,l[n.elemNum].y+o,!1)}this.displayGrid.call(this),n.classList.remove("gridSelected"),n.classList.remove("lyteGridStackMove"),n.style.removeProperty(this.rtlfunc("left")),n.style.removeProperty("top"),n.style.removeProperty("height"),n.style.removeProperty("width"),Lyte.arrayUtils(i.occupied,"remove",0,i.occupied.length),0!=r&&this.topCheck.call(this,n,a),0==n.flag&&n._childGrid&&setTimeout(n._childGrid.reRender,150,!0),delete n.initialy,delete n.xPos,delete n.yPos,delete n.flag,delete n.offLeft,delete n.offTop,delete n.initialx,delete n.instantPreviousX,delete n.instantPreviousY,delete n.val,delete n.xOff,delete n.yOff,delete n.initialLeft,delete n.initialTop,delete n.flag,delete n.value,delete n.prevEvX,delete n.prevEvY}s&&(s.style.display="none"),this.findGrid()}window.cancelAnimationFrame(this._reqId),delete this._reqId,delete this._scrollCheck,t.stopPropagation(),t.preventDefault()}if(0!=r){if(this.displayGrid.call(this),i.SelectedNodes.length&&i.previousPosFind){var d=this.data.ltPropHandler;this.previousPos.call(this,a.querySelectorAll(d))}this.getMethods("onDrop")&&this.executeMethod("onDrop",h,t,this.$node)}else i.currentPos+=1,this.undoPrevious.call(this);document.body.removeEventListener("mousemove",this.mvefunc,!0),i.SelectedNodes=[]}document.removeEventListener("mouseup",this.upfunc,!0)},keydown:function(t){document._lyteCurrentGrid==this&&this.getData("ltPropUndo")&&!this.getData("ltPropFreezeMode")&&((t.ctrlKey||t.metaKey)&&t.shiftKey&&90==t.keyCode?this.undoNext.call(this):!t.ctrlKey&&!t.metaKey||t.shiftKey||90!=t.keyCode||this.undoPrevious.call(this))},returnWid:function(t,e,i){if(t){if(t.constructor!=String)return t;var l,a,r,h=t.match(/[\w|.]+(?=%)/gi);return h&&h.length?(e?(r="width",l=this.getData("ltPropUnitXCopy")):(r="height",l=this.getData("ltPropUnitY"),a="ltPropMarginTop"),this.gridLength((this.bcrrelem?this.bcrrelem[r]:this.scopeElement.getBoundingClientRect()[r])*parseFloat(h[0])/100,l,a)):parseInt(t)}},initialPosFind:function(t){var e={},i=this.getData("ltPropForcedReposition");return e.x=t.getAttribute("lyte-grid-x")&&!i?parseInt(t.getAttribute("lyte-grid-x")):void 0,e.y=t.getAttribute("lyte-grid-y")&&!i?parseInt(t.getAttribute("lyte-grid-y")):void 0,e.length=t.getAttribute("lyte-grid-length")?this.returnWid(t.getAttribute("lyte-grid-length"),!0,t):this.returnWid(this.getData("ltPropDefaultLength"),!0),e.height=t.getAttribute("lyte-grid-height")?this.returnWid(t.getAttribute("lyte-grid-height"),null,t):this.returnWid(this.getData("ltPropDefaultHeight")),e},checkPreviousGrid:function(){for(var t=this.$node.parentElement;t&&"BODY"!=t.tagName;){if("LYTE-GRIDSTACK"==t.tagName){this._parentGrid=t,this._parentGridIndex=t.component._childGrids.length,t.component._childGrids.push(this.$node);break}"LYTE-GRID-CONTENT"==t.tagName&&(t.parentElement._childGrid=this.$node,this._parentComp=t.parentElement),t=t.parentElement}return!(!t||"LYTE-GRIDSTACK"!=t.tagName)},retNode:function(t,e){for(var i=[],l=0;l<t.length;l++)e[t[l]]&&i.push(e[t[l]].nodeName);return i},findGrid:function(){var t,e,i=this.$node.getBoundingClientRect(),l=this.getData("lyteGridStack"),a=this.$node.scrollLeft,r=this.$node.scrollTop,h=a+i.width,s=r+i.height,n={left:this.returnY({offLeft:a}),top:this.returnY({offTop:r},!0),right:this.returnY({offLeft:h}),bottom:this.returnY({offTop:s},!0)};this.setData("ltPropVisibleBoundary",n),t=this.similarData(this.multipleRemoval(this.yElementsFind(n.top+1,n.bottom-1,this.getData("yElements"))),this.multipleRemoval(this.yElementsFind(n.left+1,n.right-1,this.getData("xElements")))),e=this.retNode(t,l),this.setData("ltPropVisible",e)},scroll:function(t){this.findGrid(),this.getMethods("onScroll")&&this.executeMethod("onScroll",this.getData("ltPropVisible"),this.getData("ltPropVisibleBoundary"),this.$node)},click:function(t){var e=this.data.ltPropGridSelectionClass;if(e){for(var i=this.nodeName(t),l=this.$node.querySelectorAll("."+e),a=0;a<l.length;a++)l[a].classList.remove(e);i&&i.classList.add(e)}},didConnect:function(){var t=this.data.ltPropScope.trim(),e=this.data.ltPropUnitX,i=this.data.ltPropMarginLeft;this.setData("ltPropUnitXCopy",e),this.setData("ltPropMarginLeftCopy",i),this._scroll=this.scroll.bind(this),this._click=this.click.bind(this),this.$node.addEventListener("scroll",this._scroll,!0),document.addEventListener("click",this._click);var l=this.$node.querySelector(t);this.data.lyteQuerySelector;this.scopeElement=l,l.classList.add("lyteGridstackScope"),-1==l.tabIndex&&(l.tabIndex=0),l.lyteData={},l.component=this,l.addEventListener("mousedown",function(t){t.target!=this&&2!=t.button&&(this.component.mousedown.call(this.component,t),t.shiftKey||document.addEventListener("mouseup",this.component.upfunc,!0),t.stopPropagation()),document._lyteCurrentGrid=this.component}),this.setData("lyteQuerySelector.keydown",this.keydown.bind(this)),document.addEventListener("keydown",this.getData("lyteQuerySelector").keydown),this.$node.getEmptyPos=function(t){return this.emptySpaceFind.call(this,t||{})}.bind(this),this.$node.addGrid=function(t,e){$L.fastdom.mutate(function(){t._addGrid=!0;var i=this.getData("ltPropColumnMode");e=void 0!=e?e:{};var l=parseInt(t.getAttribute("lyte-grid-x")),a=parseInt(t.getAttribute("lyte-grid-y")),r=parseInt(t.getAttribute("lyte-grid-length")),h=parseInt(t.getAttribute("lyte-grid-height"));for(var s in isNaN(l)||(e.x=l),isNaN(a)||(e.y=a),isNaN(r)||(e.length=r),isNaN(h)||(e.height=h),e.length&&(e.length=this.returnWid(e.length,!0,t)),e.height&&(e.height=this.returnWid(e.height,null,t)),e)e[s]&&"resize"!=s&&(e[s]=parseInt(e[s]));if(e.nodeName=t,t.classList.add("lyteGridstackHandler"),!i){var n=this.emptySpaceFind.call(this,e);n[1]?(t.setAttribute("lyte-grid-x",n[0].x),t.setAttribute("lyte-grid-y",n[0].y)):(t.setAttribute("lyte-grid-x",void 0!=e.x&&e.x.constructor==Number?e.x:n[0].x),t.setAttribute("lyte-grid-y",void 0!=e.y&&e.y.constructor==Number?e.y:n[0].y)),t.setAttribute("lyte-grid-length",e.length?e.length:this.returnWid(this.getData("ltPropDefaultLength"),!0)),t.setAttribute("lyte-grid-height",e.height?e.height:this.returnWid(this.getData("ltPropDefaultHeight"))),t.setAttribute("lyte-grid-min-length",e.minLength?e.minLength:this.returnWid(this.getData("ltPropDefaultMinLength"),!0)),t.setAttribute("lyte-grid-min-height",e.minHeight?e.minHeight:this.returnWid(this.getData("ltPropDefaultMinHeight"))),t.setAttribute("lyte-grid-max-length",e.maxLength?e.maxLength:this.returnWid(this.getData("ltPropDefaultMaxLength"),!0)),t.setAttribute("lyte-grid-max-height",e.maxHeight?e.maxHeight:this.returnWid(this.getData("ltPropDefaultMaxHeight")))}"disabled"==e.resize&&t.setAttribute("lt-prop-resize",e.resize),this.scopeElement.contains(t)||LyteComponent.appendChild(this.scopeElement,t),this.initialValSet.call(this,!0),this.cssConstruct.call(this,t,"lyte-grid-y"),this.getData("iniData").push(this.initialPosFind.call(this,t));var o=this.getData("lyteGridStack");this.previousPos.call(this,o.length),$L.fastdom.mutate(function(){if(n&&0==n[1]&&!i){if(this.topCheck.call(this,t,this.scopeElement,null,!0),!this.getData("ltPropFloat")){this.topCheck.call(this,t,this.scopeElement,null,!0);var e=this.heightGet.call(this,t);e&&(o[t.elemNum].y-=e,this.valueUpdating.call(this,t.elemNum,"lyte-grid-y",o[t.elemNum].y),this.setVal.call(this,t,"lyte-grid-y",o[t.elemNum].y),this.previousPos.call(this,o.length)),this.topMoveFunc.call(this,t,null,null,null,!0)}this.findGrid()}t._childGrid&&t._childGrid.reRender(null,!0),this.getMethods("onItemAdd")&&$L.fastdom.measure(function(){$L.fastdom.mutate(function(){this.executeMethod("onItemAdd",t,this.data.lyteGridStack[t.elemNum],this.$node)}.bind(this))}.bind(this))}.bind(this))}.bind(this))}.bind(this),this.$node.removeGrid=function(t){if(this.scopeElement.contains(t)){var e=this.getData("ltPropHandler"),i=this.getData("lyteGridStack"),l=i[t.elemNum].y+i[t.elemNum].height;Lyte.arrayUtils(this.getData("iniData"),"removeAt",t.elemNum),document.body.contains(t)&&t.parentElement.removeChild(t),Lyte.arrayUtils(this.getData("lyteGridStack"),"remove",0,i.length),this.initialValSet.call(this),this.positionFind.call(this,(/^#/g.test(e)&&/\s/g.test(e),this.scopeElement.querySelectorAll(e))),this.findGrid(),this.topMoveAllGrid(l,i)}}.bind(this),this.$node.reRender=function(t){this._style&&(this.$node.removeChild(this._style),delete this._style);var e=this.getData("lyteGridStack");Lyte.arrayUtils(e,"remove",0,e.length),this.didConnectWrk.call(this,!0,t)}.bind(this),this.$node.setProperty=function(t,e,i){i="height"==e||"length"==e?this.returnWid(i,"length"==e,t):parseInt(i);var l=this.getData("lyteGridStack"),a=["x","y","length","height"],r={};if(-1!=a.indexOf(e)){for(var h in l[t.elemNum])-1!=a.indexOf(h)&&(r[h]=l[t.elemNum][h]);r[e]=i,r.nodeName=t;var s=this.emptySpaceFind.call(this,r);if(s[1])for(var n in s[0])this.setVal.call(this,t,"lyte-grid-"+n,s[0][n])}this.setVal.call(this,t,"lyte-grid-"+e,i);var o=e.replace(/(-\w)/g,function(t){return t[1].toUpperCase()});if(l[t.elemNum][o]=i,-1!=a.indexOf(e)){if(this.valueUpdating.call(this,t.elemNum,"lyte-grid-"+e,i),this.previousPos.call(this,l.length),0==s[1]&&this.topCheck.call(this,t,this.scopeElement,null,!0),!this.getData("ltPropFloat")){var d=this.heightGet.call(this,t);d&&(l[t.elemNum].y-=d,this.valueUpdating.call(this,t.elemNum,"lyte-grid-y",l[t.elemNum].y),this.setVal.call(this,t,"lyte-grid-y",l[t.elemNum].y),this.previousPos.call(this,l.length)),this.topMoveFunc.call(this,t,null,null,null,!0)}this.previousPos.call(this,this.scopeElement.querySelectorAll(this.data.ltPropHandler))}t._childGrid&&("height"!=e&&"length"!=e||t._childGrid.reRender(!0)),this.findGrid(),this.getMethods("onPropertyChange")&&$L.fastdom.measure(function(){$L.fastdom.mutate(function(){this.executeMethod("onPropertyChange",t,e,this.data.lyteGridStack[t.elemNum],this.$node)}.bind(this))}.bind(this))}.bind(this),this._resizeFunc=this.windowResize.bind(this),this._initialWindowWidth=window.innerWidth,window.addEventListener("resize",this._resizeFunc,!0),this.checkPreviousGrid()||this.didConnectWrk.call(this,!0)},gridLength:function(t,e,i){i=i||"ltPropMarginLeftCopy";var l=parseInt(this.getData(i)),a=e||this.data.ltPropUnitX;return parseInt((((t||(this.bcrrelem?this.bcrrelem.width:this.scopeElement.getBoundingClientRect().width))-l)/(a+l)).toFixed(0))},columnModeLengthFind:function(){this._prevObs=!0;var t=this.getData("ltPropGridLength")||this.getData("ltPropColumn"),e=this.getData("ltPropMarginLeftCopy");e=e||this.getData("ltPropMarginLeft"),this.setData("ltPropUnitX",((this.bcrrelem?this.bcrrelem.width:this.scopeElement.getBoundingClientRect().width)-(t+1)*e)/t),delete this._prevObs},didConnectWrk:function(t,e){$L.fastdom.measure(function(){if(this.$node.offsetParent){this.data.direction=_lyteUiUtils.getRTL(),this.data.direction?this.$node.classList.add("lyteRTL"):this.$node.classList.remove("lyteRTL");var i=this.scopeElement.getBoundingClientRect(),l=this.scopeElement,a=this.getData("lyteQuerySelector");this.bcrrelem=i;var r=this.getData("ltPropColumnMode"),h=this.getData("ltPropHandler"),s=this.getData("iniData");this.getData("lyteGridStack");Lyte.arrayUtils(s,"remove",0,s.length);var n=(/^#/g.test(h)&&/\s/g.test(h),l.querySelectorAll(h));if(this._parentGrid&&!this.getData("ltPropGridLength")){var o=this.gridLength();this.setData("ltPropGridLength",o),this.setData("gridLength",o)}(r||this.getData("ltPropGridLength"))&&this.columnModeLengthFind(),(!this.getData("gridLength")||e||r)&&this.setData("gridLength",this.gridLength()),!this.$node.ltProp("gridHeight")&&!e||r?this.$node.ltProp("gridHeight",this.getData("gridLength")):e&&this.$node.ltProp("gridHeight",this.getData("gridLength"));for(var d=0;d<n.length;d++)s.push(this.initialPosFind.call(this,n[d]));$L.fastdom.mutate(this.initialValSet.bind(this));n=l.querySelectorAll(this.data.ltPropHandler);var g=this.data.ltPropUnitX;l.lyteData.gridLength=this.data.gridLength,l.lyteData.gridHeight=a.maxHeight,this._initialXRatio=g/(i.width-this.data.gridLength*this.data.ltPropMarginLeft),$L.fastdom.mutate(function(){if(this._childGrids.length)for(var e=0;e<this._childGrids.length;e++)this._childGrids[e].reRender();t&&this.getMethods("afterRender")&&$L.fastdom.measure(function(){$L.fastdom.mutate(function(){this.executeMethod("afterRender",this.$node)}.bind(this))}.bind(this)),this.findGrid()}.bind(this))}}.bind(this))},data:function(){return{ltPropScope:Lyte.attr("string",{default:""}),ltPropHandler:Lyte.attr("string",{default:""}),ltPropMarginLeft:Lyte.attr("number",{default:10}),ltPropMarginTop:Lyte.attr("number",{default:10}),ltPropUnitX:Lyte.attr("number",{default:50}),ltPropUnitY:Lyte.attr("number",{default:50}),ltPropResizeDirection:Lyte.attr("array",{default:["left","right","bottom","bottomRight","bottomLeft","top","topLeft","topRight"]}),ltPropFloat:Lyte.attr("boolean",{default:!1}),ltPropDirection:Lyte.attr("string",{default:"vertical"}),ltPropUndo:Lyte.attr("boolean",{default:!0}),ltPropResize:Lyte.attr("boolean",{default:!0}),ltPropBestfit:Lyte.attr("boolean",{default:!0}),ltPropMinUnitX:Lyte.attr("number",{default:0}),ltPropMinMarginLeft:Lyte.attr("number",{default:0}),ltPropBestfitClass:Lyte.attr("string",{default:""}),ltPropFreezeMode:Lyte.attr("boolean",{default:!1}),ltPropDefaultLength:Lyte.attr("string",{default:"2"}),ltPropDefaultHeight:Lyte.attr("string",{default:"2"}),ltPropDefaultMinLength:Lyte.attr("string",{default:"1"}),ltPropDefaultMinHeight:Lyte.attr("string",{default:"1"}),ltPropDefaultMaxHeight:Lyte.attr("string",{default:"0"}),ltPropDefaultMaxLength:Lyte.attr("string",{default:"0"}),ltPropColumnMode:Lyte.attr("boolean",{default:!1}),ltPropColumn:Lyte.attr("number",{default:3}),ltPropPrevent:Lyte.attr("object",{default:{horizontal:!1,vertical:!1}}),ltPropGridLength:Lyte.attr("number",{default:void 0}),ltPropBestfitType:Lyte.attr("string",{default:"default"}),ltPropForcedReposition:Lyte.attr("boolean",{default:!1}),ltPropSquareGrid:Lyte.attr("boolean",{default:!1}),ltPropGridSpaceColor:Lyte.attr("string",{default:"#f8f8f8"}),ltPropHitBottom:Lyte.attr("boolean",{default:!1}),ltPropGridSelectionClass:Lyte.attr("string",{default:"lyteGridFocused"}),ltPropVisibleBoundary:Lyte.attr("object",{default:{}}),ltPropVisible:Lyte.attr("array",{default:[]}),gridLength:Lyte.attr("number",{default:void 0}),ltPropGridHeight:Lyte.attr("number",{default:void 0}),ltPropMarginLeftCopy:Lyte.attr("number",{default:10}),ltPropUnitXCopy:Lyte.attr("number",{default:50}),lyteGridStack:Lyte.attr("array",{default:[]}),elements:Lyte.attr("object",{default:void 0}),oriNode:Lyte.attr("object",{default:void 0}),xElements:Lyte.attr("array",{default:[]}),yElements:Lyte.attr("array",{default:[]}),iniData:Lyte.attr("array",{default:[]}),lyteQuerySelector:Lyte.attr("object",{default:{}}),direction:Lyte.attr("boolean",{default:!1})}},undoPrevious:function(){var t=this.getData("lyteGridStack"),e=this.getData("lyteQuerySelector"),i=this.scopeElement.querySelectorAll(this.data.ltPropHandler);if(e.currentPos<=t[t.length-1].oldHeight.length&&e.currentPos>=1){for(var l=0;l<i.length;l++)t[l].x=parseInt(t[l].oldX[e.currentPos-1]),t[l].nodeName.dataSet["lyte-grid-x-old"]=t[l].x,t[l].y=parseInt(t[l].oldY[e.currentPos-1]),t[l].nodeName.dataSet["lyte-grid-y-old"]=t[l].y,t[l].length=parseInt(t[l].oldLength[e.currentPos-1]),t[l].nodeName.dataSet["lyte-grid-length-old"]=t[l].length,t[l].height=parseInt(t[l].oldHeight[e.currentPos-1]),t[l].nodeName.dataSet["lyte-grid-height-old"]=t[l].height;this.displayGrid.call(this),e.currentPos=e.currentPos-1>=0?e.currentPos-1:0}},undoNext:function(){var t=this.getData("lyteGridStack"),e=this.getData("lyteQuerySelector"),i=this.scopeElement.querySelectorAll(this.data.ltPropHandler);if(e.currentPos<=t[t.length-1].oldHeight.length-1){for(var l=e.currentPos<t[t.length-1].oldHeight.length-1?e.currentPos+1:t[t.length-1].oldHeight.length-1,a=0;a<i.length;a++)t[a].x=parseInt(t[a].oldX[l]),t[a].nodeName.dataSet["lyte-grid-x-old"]=t[a].x,t[a].y=parseInt(t[a].oldY[l]),t[a].nodeName.dataSet["lyte-grid-y-old"]=t[a].y,t[a].length=parseInt(t[a].oldLength[l]),t[a].nodeName.dataSet["lyte-grid-length-old"]=t[a].length,t[a].height=parseInt(t[a].oldHeight[l]),t[a].nodeName.dataSet["lyte-grid-height-old"]=t[a].height;this.displayGrid.call(this),e.currentPos=l}},emptySpaceFind:function(t,e,i,l){var a=this.getData("lyteGridStack"),r=[],h=this.getData("gridLength"),s=this.getData("ltPropGridHeight");if(e)r=r.concat(i.slice());else{for(y=0;y<h;y++){r.push([]);for(var n=0;n<s;n++)r[y].push(!1)}for(y=0;y<a.length;y++)if(void 0!=a[y].x&&void 0!=a[y].y)for(var o=a[y].x;o<a[y].x+a[y].length;o++)for(var d=a[y].y;d<a[y].y+a[y].height;d++)a[y].nodeName!=t.nodeName&&void 0!=r[o]&&"res"!=r[o][d]?r[o][d]=!0:r[o]&&0==r[o][d]&&(r[o][d]="res")}t.length=void 0!=t.length?t.length:this.returnWid(this.getData("ltPropDefaultLength"),!0),t.height=void 0!=t.height?t.height:this.returnWid(this.getData("ltPropDefaultHeight"));for(var g,m=t.x?t.x:0,c=t.y?t.y:0,u=void 0==t.x||isNaN(t.x)?h+1-t.length:t.x+1,p=void 0==t.y||isNaN(t.x)?s-1:t.y,y=c;y<=p;y++)for(var f=m;f<u;f++){var v=!0;for(o=f;o<f+t.length;o++){for(var x=y;x<y+t.height;x++)if(r[o]&&1==r[o][x]){v=!1,x-y;break}if(!v)break}if(v&&f<h+1-t.length)return[{x:f,y:y},!e]}if(!e){var N={length:t.length,height:t.height,nodeName:t.nodeName};t.x&&!t.y&&(this.setData("ltPropGridHeight",s+t.height),N.x=t.x),g=this.emptySpaceFind.call(this,N,!0,r)}return g||(this.setData("ltPropGridHeight",s+t.height),g=this.emptySpaceFind.call(this,{length:t.length,height:t.height,nodeName:t.nodeName},!0,r,!0)),g.constructor==Array?g:[g,!1]}});